{"version":3,"sources":["../../../src/text-layer/font-atlas-manager.ts"],"names":["getDefaultCharacterSet","charSet","i","push","String","fromCharCode","DEFAULT_FONT_SETTINGS","fontFamily","fontWeight","characterSet","fontSize","buffer","sdf","cutoff","radius","smoothing","MAX_CANVAS_WIDTH","BASELINE_SCALE","HEIGHT_SCALE","CACHE_LIMIT","cache","LRUCache","getNewChars","cacheKey","newCharSet","Set","Array","from","cachedFontAtlas","get","char","mapping","has","delete","populateAlphaChannel","alphaChannel","imageData","length","data","setTextStyle","ctx","font","fillStyle","textBaseline","textAlign","setFontAtlasCacheLimit","limit","log","assert","Number","isFinite","FontAtlasManager","_atlas","props","Object","assign","_key","_getKey","size","fontAtlas","_generateFontAtlas","set","canvas","document","createElement","width","getContext","willReadFrequently","getFontWidth","measureText","fontHeight","maxCanvasWidth","xOffset","yOffset","canvasHeight","height","getImageData","putImageData","tinySDF","TinySDF","draw","glyphTop","layoutOffsetY","createImageData","x","y","fillText"],"mappings":"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","sourcesContent":["/* global document */\nimport TinySDF from '@mapbox/tiny-sdf';\n\nimport {log} from '@deck.gl/core';\n\nimport {buildMapping, CharacterMapping} from './utils';\nimport LRUCache from './lru-cache';\n\nimport type {Texture} from '@deck.gl/core';\n\nfunction getDefaultCharacterSet() {\n  const charSet: string[] = [];\n  for (let i = 32; i < 128; i++) {\n    charSet.push(String.fromCharCode(i));\n  }\n  return charSet;\n}\n\nexport type FontSettings = {\n  /** CSS font family\n   * @default 'Monaco, monospace'\n   */\n  fontFamily?: string;\n  /** CSS font weight\n   * @default 'normal'\n   */\n  fontWeight?: string | number;\n  /** Specifies a list of characters to include in the font.\n   * @default (ASCII characters 32-128)\n   */\n  characterSet?: Set<string> | string[] | string;\n  /** Font size in pixels. This option is only applied for generating `fontAtlas`, it does not impact the size of displayed text labels. Larger `fontSize` will give you a sharper look when rendering text labels with very large font sizes. But larger `fontSize` requires more time and space to generate the `fontAtlas`.\n   * @default 64\n   */\n  fontSize?: number;\n  /** Whitespace buffer around each side of the character. In general, bigger `fontSize` requires bigger `buffer`. Increase `buffer` will add more space between each character when layout `characterSet` in `fontAtlas`. This option could be tuned to provide sufficient space for drawing each character and avoiding overlapping of neighboring characters.\n   * @default 4\n   */\n  buffer?: number;\n  /** Flag to enable / disable `sdf`. [`sdf` (Signed Distance Fields)](http://cs.brown.edu/people/pfelzens/papers/dt-final.pdf) will provide a sharper look when rendering with very large or small font sizes. `TextLayer` integrates with [`TinySDF`](https://github.com/mapbox/tiny-sdf) which implements the `sdf` algorithm.\n   * @default false\n   */\n  sdf?: boolean;\n  /** How much of the radius (relative) is used for the inside part the glyph. Bigger `cutoff` makes character thinner. Smaller `cutoff` makes character look thicker. Only applies when `sdf: true`.\n   * @default 0.25\n   */\n  cutoff?: number;\n  /** How many pixels around the glyph shape to use for encoding distance. Bigger radius yields higher quality outcome. Only applies when `sdf: true`.\n   * @default 12\n   */\n  radius?: number;\n  /** How much smoothing to apply to the text edges. Only applies when `sdf: true`.\n   * @default 0.1\n   */\n  smoothing?: number;\n};\n\nexport const DEFAULT_FONT_SETTINGS: Required<FontSettings> = {\n  fontFamily: 'Monaco, monospace',\n  fontWeight: 'normal',\n  characterSet: getDefaultCharacterSet(),\n  fontSize: 64,\n  buffer: 4,\n  sdf: false,\n  cutoff: 0.25,\n  radius: 12,\n  smoothing: 0.1\n};\n\nconst MAX_CANVAS_WIDTH = 1024;\n\nconst BASELINE_SCALE = 0.9;\nconst HEIGHT_SCALE = 1.2;\n\n// only preserve latest three fontAtlas\nconst CACHE_LIMIT = 3;\n\ntype FontAtlas = {\n  /** x position of last character in mapping */\n  xOffset: number;\n  /** y position of last character in mapping */\n  yOffset: number;\n  /** bounding box of each character in the texture */\n  mapping: CharacterMapping;\n  /** packed texture */\n  data: HTMLCanvasElement;\n  /** texture width */\n  width: number;\n  /** texture height */\n  height: number;\n};\n\nlet cache = new LRUCache<FontAtlas>(CACHE_LIMIT);\n\n/**\n * get all the chars not in cache\n * @returns chars not in cache\n */\nfunction getNewChars(cacheKey: string, characterSet: Set<string> | string[] | string): Set<string> {\n  let newCharSet: Set<string>;\n  if (typeof characterSet === 'string') {\n    newCharSet = new Set(Array.from(characterSet));\n  } else {\n    newCharSet = new Set(characterSet);\n  }\n\n  const cachedFontAtlas = cache.get(cacheKey);\n  if (!cachedFontAtlas) {\n    return newCharSet;\n  }\n\n  for (const char in cachedFontAtlas.mapping) {\n    if (newCharSet.has(char)) {\n      newCharSet.delete(char);\n    }\n  }\n  return newCharSet;\n}\n\nfunction populateAlphaChannel(alphaChannel: Uint8ClampedArray, imageData: ImageData): void {\n  // populate distance value from tinySDF to image alpha channel\n  for (let i = 0; i < alphaChannel.length; i++) {\n    imageData.data[4 * i + 3] = alphaChannel[i];\n  }\n}\n\nfunction setTextStyle(\n  ctx: CanvasRenderingContext2D,\n  fontFamily: string,\n  fontSize: number,\n  fontWeight: string | number\n): void {\n  ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = '#000';\n  ctx.textBaseline = 'alphabetic';\n  ctx.textAlign = 'left';\n}\n\n/**\n * Sets the Font Atlas LRU Cache Limit\n * @param {number} limit LRU Cache limit\n */\nexport function setFontAtlasCacheLimit(limit: number): void {\n  log.assert(Number.isFinite(limit) && limit >= CACHE_LIMIT, 'Invalid cache limit');\n\n  cache = new LRUCache(limit);\n}\n\nexport default class FontAtlasManager {\n  /** Font settings */\n  props: Required<FontSettings> = {...DEFAULT_FONT_SETTINGS};\n\n  /** Cache key of the current font atlas */\n  private _key?: string;\n  /** The current font atlas */\n  private _atlas?: FontAtlas;\n\n  get texture(): Texture | undefined {\n    return this._atlas;\n  }\n\n  get mapping(): CharacterMapping | undefined {\n    return this._atlas && this._atlas.mapping;\n  }\n\n  get scale(): number {\n    const {fontSize, buffer} = this.props;\n    return (fontSize * HEIGHT_SCALE + buffer * 2) / fontSize;\n  }\n\n  setProps(props: FontSettings = {}) {\n    Object.assign(this.props, props);\n\n    // update cache key\n    this._key = this._getKey();\n\n    const charSet = getNewChars(this._key, this.props.characterSet);\n    const cachedFontAtlas = cache.get(this._key);\n\n    // if a fontAtlas associated with the new settings is cached and\n    // there are no new chars\n    if (cachedFontAtlas && charSet.size === 0) {\n      // update texture with cached fontAtlas\n      if (this._atlas !== cachedFontAtlas) {\n        this._atlas = cachedFontAtlas;\n      }\n      return;\n    }\n\n    // update fontAtlas with new settings\n    const fontAtlas = this._generateFontAtlas(charSet, cachedFontAtlas);\n    this._atlas = fontAtlas;\n\n    // update cache\n    cache.set(this._key, fontAtlas);\n  }\n\n  // eslint-disable-next-line max-statements\n  private _generateFontAtlas(characterSet: Set<string>, cachedFontAtlas?: FontAtlas): FontAtlas {\n    const {fontFamily, fontWeight, fontSize, buffer, sdf, radius, cutoff} = this.props;\n    let canvas = cachedFontAtlas && cachedFontAtlas.data;\n    if (!canvas) {\n      canvas = document.createElement('canvas');\n      canvas.width = MAX_CANVAS_WIDTH;\n    }\n    const ctx = canvas.getContext('2d', {willReadFrequently: true})!;\n\n    setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n    // 1. build mapping\n    const {mapping, canvasHeight, xOffset, yOffset} = buildMapping({\n      getFontWidth: char => ctx.measureText(char).width,\n      fontHeight: fontSize * HEIGHT_SCALE,\n      buffer,\n      characterSet,\n      maxCanvasWidth: MAX_CANVAS_WIDTH,\n      ...(cachedFontAtlas && {\n        mapping: cachedFontAtlas.mapping,\n        xOffset: cachedFontAtlas.xOffset,\n        yOffset: cachedFontAtlas.yOffset\n      })\n    });\n\n    // 2. update canvas\n    // copy old canvas data to new canvas only when height changed\n    if (canvas.height !== canvasHeight) {\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      canvas.height = canvasHeight;\n      ctx.putImageData(imageData, 0, 0);\n    }\n    setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n    // 3. layout characters\n    if (sdf) {\n      const tinySDF = new TinySDF({\n        fontSize,\n        buffer,\n        radius,\n        cutoff,\n        fontFamily,\n        fontWeight: `${fontWeight}`\n      });\n\n      for (const char of characterSet) {\n        const {data, width, height, glyphTop} = tinySDF.draw(char);\n        mapping[char].width = width;\n        mapping[char].layoutOffsetY = fontSize * BASELINE_SCALE - glyphTop;\n\n        const imageData = ctx.createImageData(width, height);\n        populateAlphaChannel(data, imageData);\n        ctx.putImageData(imageData, mapping[char].x, mapping[char].y);\n      }\n    } else {\n      for (const char of characterSet) {\n        ctx.fillText(char, mapping[char].x, mapping[char].y + buffer + fontSize * BASELINE_SCALE);\n      }\n    }\n\n    return {\n      xOffset,\n      yOffset,\n      mapping,\n      data: canvas,\n      width: canvas.width,\n      height: canvas.height\n    };\n  }\n\n  private _getKey(): string {\n    const {fontFamily, fontWeight, fontSize, buffer, sdf, radius, cutoff} = this.props;\n    if (sdf) {\n      return `${fontFamily} ${fontWeight} ${fontSize} ${buffer} ${radius} ${cutoff}`;\n    }\n    return `${fontFamily} ${fontWeight} ${fontSize} ${buffer}`;\n  }\n}\n"],"file":"font-atlas-manager.js"}