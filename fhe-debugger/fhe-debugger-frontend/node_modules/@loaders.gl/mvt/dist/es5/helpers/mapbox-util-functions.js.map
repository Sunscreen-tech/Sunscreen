{"version":3,"file":"mapbox-util-functions.js","names":["classifyRings","rings","len","length","polygons","polygon","ccw","i","area","signedArea","undefined","push","ring","sum","j","p1","p2","readFeature","tag","feature","pbf","id","readVarint","readTag","type","_geometry","pos","end","key","_keys","value","_values","properties"],"sources":["../../../src/helpers/mapbox-util-functions.ts"],"sourcesContent":["import Protobuf from 'pbf';\nimport {MVTMapboxGeometry} from '../lib/types';\nimport VectorTileFeature from '../lib/mapbox-vector-tile/vector-tile-feature';\n\n/**\n * Classifies an array of rings into polygons with outer rings and holes\n * @param rings\n * @returns polygons\n */\nexport function classifyRings(rings: MVTMapboxGeometry) {\n  const len = rings.length;\n\n  if (len <= 1) return [rings];\n\n  const polygons: number[][][] = [];\n  let polygon: number[][] | undefined;\n  let ccw: boolean | undefined;\n\n  for (let i = 0; i < len; i++) {\n    const area = signedArea(rings[i]);\n    if (area === 0) continue; // eslint-disable-line no-continue\n\n    if (ccw === undefined) ccw = area < 0;\n\n    if (ccw === area < 0) {\n      if (polygon) polygons.push(polygon);\n      polygon = [rings[i]];\n    } else if (polygon) polygon.push(rings[i]);\n  }\n  if (polygon) polygons.push(polygon);\n\n  return polygons;\n}\n\n/**\n *\n * @param ring\n * @returns sum\n */\nexport function signedArea(ring: number[][]) {\n  let sum = 0;\n  for (let i = 0, j = ring.length - 1, p1: number[], p2: number[]; i < ring.length; j = i++) {\n    p1 = ring[i];\n    p2 = ring[j];\n    sum += (p2[0] - p1[0]) * (p1[1] + p2[1]);\n  }\n  return sum;\n}\n\n/**\n *\n * @param tag\n * @param feature\n * @param pbf\n */\nexport function readFeature(tag: number, feature?: VectorTileFeature, pbf?: Protobuf): void {\n  if (feature && pbf) {\n    if (tag === 1) feature.id = pbf.readVarint();\n    else if (tag === 2) readTag(pbf, feature);\n    else if (tag === 3) feature.type = pbf.readVarint();\n    else if (tag === 4) feature._geometry = pbf.pos;\n  }\n}\n\n/**\n *\n * @param pbf\n * @param feature\n */\nexport function readTag(pbf: Protobuf, feature: VectorTileFeature): void {\n  const end = pbf.readVarint() + pbf.pos;\n\n  while (pbf.pos < end) {\n    const key = feature._keys[pbf.readVarint()];\n    const value = feature._values[pbf.readVarint()];\n    feature.properties[key] = value;\n  }\n}\n"],"mappings":";;;;;;;;;AASO,SAASA,aAAaA,CAACC,KAAwB,EAAE;EACtD,IAAMC,GAAG,GAAGD,KAAK,CAACE,MAAM;EAExB,IAAID,GAAG,IAAI,CAAC,EAAE,OAAO,CAACD,KAAK,CAAC;EAE5B,IAAMG,QAAsB,GAAG,EAAE;EACjC,IAAIC,OAA+B;EACnC,IAAIC,GAAwB;EAE5B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,GAAG,EAAEK,CAAC,EAAE,EAAE;IAC5B,IAAMC,IAAI,GAAGC,UAAU,CAACR,KAAK,CAACM,CAAC,CAAC,CAAC;IACjC,IAAIC,IAAI,KAAK,CAAC,EAAE;IAEhB,IAAIF,GAAG,KAAKI,SAAS,EAAEJ,GAAG,GAAGE,IAAI,GAAG,CAAC;IAErC,IAAIF,GAAG,KAAKE,IAAI,GAAG,CAAC,EAAE;MACpB,IAAIH,OAAO,EAAED,QAAQ,CAACO,IAAI,CAACN,OAAO,CAAC;MACnCA,OAAO,GAAG,CAACJ,KAAK,CAACM,CAAC,CAAC,CAAC;IACtB,CAAC,MAAM,IAAIF,OAAO,EAAEA,OAAO,CAACM,IAAI,CAACV,KAAK,CAACM,CAAC,CAAC,CAAC;EAC5C;EACA,IAAIF,OAAO,EAAED,QAAQ,CAACO,IAAI,CAACN,OAAO,CAAC;EAEnC,OAAOD,QAAQ;AACjB;AAOO,SAASK,UAAUA,CAACG,IAAgB,EAAE;EAC3C,IAAIC,GAAG,GAAG,CAAC;EACX,KAAK,IAAIN,CAAC,GAAG,CAAC,EAAEO,CAAC,GAAGF,IAAI,CAACT,MAAM,GAAG,CAAC,EAAEY,EAAY,EAAEC,EAAY,EAAET,CAAC,GAAGK,IAAI,CAACT,MAAM,EAAEW,CAAC,GAAGP,CAAC,EAAE,EAAE;IACzFQ,EAAE,GAAGH,IAAI,CAACL,CAAC,CAAC;IACZS,EAAE,GAAGJ,IAAI,CAACE,CAAC,CAAC;IACZD,GAAG,IAAI,CAACG,EAAE,CAAC,CAAC,CAAC,GAAGD,EAAE,CAAC,CAAC,CAAC,KAAKA,EAAE,CAAC,CAAC,CAAC,GAAGC,EAAE,CAAC,CAAC,CAAC,CAAC;EAC1C;EACA,OAAOH,GAAG;AACZ;AAQO,SAASI,WAAWA,CAACC,GAAW,EAAEC,OAA2B,EAAEC,GAAc,EAAQ;EAC1F,IAAID,OAAO,IAAIC,GAAG,EAAE;IAClB,IAAIF,GAAG,KAAK,CAAC,EAAEC,OAAO,CAACE,EAAE,GAAGD,GAAG,CAACE,UAAU,CAAC,CAAC,CAAC,KACxC,IAAIJ,GAAG,KAAK,CAAC,EAAEK,OAAO,CAACH,GAAG,EAAED,OAAO,CAAC,CAAC,KACrC,IAAID,GAAG,KAAK,CAAC,EAAEC,OAAO,CAACK,IAAI,GAAGJ,GAAG,CAACE,UAAU,CAAC,CAAC,CAAC,KAC/C,IAAIJ,GAAG,KAAK,CAAC,EAAEC,OAAO,CAACM,SAAS,GAAGL,GAAG,CAACM,GAAG;EACjD;AACF;AAOO,SAASH,OAAOA,CAACH,GAAa,EAAED,OAA0B,EAAQ;EACvE,IAAMQ,GAAG,GAAGP,GAAG,CAACE,UAAU,CAAC,CAAC,GAAGF,GAAG,CAACM,GAAG;EAEtC,OAAON,GAAG,CAACM,GAAG,GAAGC,GAAG,EAAE;IACpB,IAAMC,GAAG,GAAGT,OAAO,CAACU,KAAK,CAACT,GAAG,CAACE,UAAU,CAAC,CAAC,CAAC;IAC3C,IAAMQ,KAAK,GAAGX,OAAO,CAACY,OAAO,CAACX,GAAG,CAACE,UAAU,CAAC,CAAC,CAAC;IAC/CH,OAAO,CAACa,UAAU,CAACJ,GAAG,CAAC,GAAGE,KAAK;EACjC;AACF"}