{"version":3,"file":"transform.js","names":["transformTile","tile","extent","transformed","z2","z","tx","x","ty","y","feature","features","geom","geometry","type","j","length","push","transformPoint","ring","k","Math","round"],"sources":["../../../../src/lib/geojson-tiler/transform.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n\nimport type {GeoJSONTile} from './tile';\n\n/**\n * Transforms the coordinates of each feature in the given tile from\n * mercator-projected space into (extent x extent) tile space.\n */\nexport function transformTile(tile: GeoJSONTile, extent: number): GeoJSONTile {\n  if (tile.transformed) {\n    return tile;\n  }\n\n  const z2 = 1 << tile.z;\n  const tx = tile.x;\n  const ty = tile.y;\n\n  for (const feature of tile.features) {\n    const geom = feature.geometry;\n    const type = feature.type;\n\n    feature.geometry = [];\n\n    if (type === 1) {\n      for (let j = 0; j < geom.length; j += 2) {\n        feature.geometry.push(transformPoint(geom[j], geom[j + 1], extent, z2, tx, ty));\n      }\n    } else {\n      for (let j = 0; j < geom.length; j++) {\n        const ring: number[][] = [];\n        for (let k = 0; k < geom[j].length; k += 2) {\n          ring.push(transformPoint(geom[j][k], geom[j][k + 1], extent, z2, tx, ty));\n        }\n        feature.geometry.push(ring);\n      }\n    }\n  }\n\n  tile.transformed = true;\n\n  return tile;\n}\n\n// eslint-disable-next-line max-params\nfunction transformPoint(\n  x: number,\n  y: number,\n  extent: number,\n  z2: number,\n  tx: number,\n  ty: number\n): number[] {\n  return [Math.round(extent * (x * z2 - tx)), Math.round(extent * (y * z2 - ty))];\n}\n"],"mappings":"AASA,OAAO,SAASA,aAAaA,CAACC,IAAiB,EAAEC,MAAc,EAAe;EAC5E,IAAID,IAAI,CAACE,WAAW,EAAE;IACpB,OAAOF,IAAI;EACb;EAEA,MAAMG,EAAE,GAAG,CAAC,IAAIH,IAAI,CAACI,CAAC;EACtB,MAAMC,EAAE,GAAGL,IAAI,CAACM,CAAC;EACjB,MAAMC,EAAE,GAAGP,IAAI,CAACQ,CAAC;EAEjB,KAAK,MAAMC,OAAO,IAAIT,IAAI,CAACU,QAAQ,EAAE;IACnC,MAAMC,IAAI,GAAGF,OAAO,CAACG,QAAQ;IAC7B,MAAMC,IAAI,GAAGJ,OAAO,CAACI,IAAI;IAEzBJ,OAAO,CAACG,QAAQ,GAAG,EAAE;IAErB,IAAIC,IAAI,KAAK,CAAC,EAAE;MACd,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,IAAI,CAACI,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;QACvCL,OAAO,CAACG,QAAQ,CAACI,IAAI,CAACC,cAAc,CAACN,IAAI,CAACG,CAAC,CAAC,EAAEH,IAAI,CAACG,CAAC,GAAG,CAAC,CAAC,EAAEb,MAAM,EAAEE,EAAE,EAAEE,EAAE,EAAEE,EAAE,CAAC,CAAC;MACjF;IACF,CAAC,MAAM;MACL,KAAK,IAAIO,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,IAAI,CAACI,MAAM,EAAED,CAAC,EAAE,EAAE;QACpC,MAAMI,IAAgB,GAAG,EAAE;QAC3B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,IAAI,CAACG,CAAC,CAAC,CAACC,MAAM,EAAEI,CAAC,IAAI,CAAC,EAAE;UAC1CD,IAAI,CAACF,IAAI,CAACC,cAAc,CAACN,IAAI,CAACG,CAAC,CAAC,CAACK,CAAC,CAAC,EAAER,IAAI,CAACG,CAAC,CAAC,CAACK,CAAC,GAAG,CAAC,CAAC,EAAElB,MAAM,EAAEE,EAAE,EAAEE,EAAE,EAAEE,EAAE,CAAC,CAAC;QAC3E;QACAE,OAAO,CAACG,QAAQ,CAACI,IAAI,CAACE,IAAI,CAAC;MAC7B;IACF;EACF;EAEAlB,IAAI,CAACE,WAAW,GAAG,IAAI;EAEvB,OAAOF,IAAI;AACb;AAGA,SAASiB,cAAcA,CACrBX,CAAS,EACTE,CAAS,EACTP,MAAc,EACdE,EAAU,EACVE,EAAU,EACVE,EAAU,EACA;EACV,OAAO,CAACa,IAAI,CAACC,KAAK,CAACpB,MAAM,IAAIK,CAAC,GAAGH,EAAE,GAAGE,EAAE,CAAC,CAAC,EAAEe,IAAI,CAACC,KAAK,CAACpB,MAAM,IAAIO,CAAC,GAAGL,EAAE,GAAGI,EAAE,CAAC,CAAC,CAAC;AACjF"}