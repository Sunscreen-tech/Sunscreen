!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("luma"));else if("function"==typeof define&&define.amd)define(["luma"],e);else{var n="object"==typeof exports?e(require("luma")):e(t.luma);for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,(function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(e,n){e.exports=t},function(t,e,n){t.exports=n(23)},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){function n(t,e,n,r,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,i)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function u(t){n(a,i,o,u,s,"next",t)}function s(t){n(a,i,o,u,s,"throw",t)}u(void 0)}))}}},function(t,e,n){var r=n(16);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},function(t,e,n){var r=n(10),i=n(15);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},function(t,e,n){var r=n(30),i=n(31),o=n(17),a=n(32);t.exports=function(t){return r(t)||i(t)||o(t)||a()}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){var r=n(26),i=n(27),o=n(17),a=n(28);t.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()}},function(t,e,n){var r=n(22);function i(e,n,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,n){var i=r(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},i(e,n,o||e)}t.exports=i},,,function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,r)}t.exports=n},function(t,e,n){var r=n(18);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){var r=n(16),i=n(29);function o(e,n,a){return i()?t.exports=o=Reflect.construct:t.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}t.exports=o},function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,u,s,c,l,v,p,d=e&&e.length,m=d?e[0]*n:t.length,g=i(t,0,m,n,!0),x=[];if(!g||g.next===g.prev)return x;if(d&&(g=function(t,e,n,r){var a,u,s,c,l,v=[];for(a=0,u=e.length;a<u;a++)s=e[a]*r,c=a<u-1?e[a+1]*r:t.length,(l=i(t,s,c,r,!1))===l.next&&(l.steiner=!0),v.push(y(l));for(v.sort(f),a=0;a<v.length;a++)h(v[a],n),n=o(n,n.next);return n}(t,e,g,n)),t.length>80*n){r=s=t[0],u=c=t[1];for(var b=n;b<m;b+=n)(l=t[b])<r&&(r=l),(v=t[b+1])<u&&(u=v),l>s&&(s=l),v>c&&(c=v);p=0!==(p=Math.max(s-r,c-u))?1/p:0}return a(g,x,n,r,u,p),x}function i(t,e,n,r,i){var o,a;if(i===M(t,e,n,r)>0)for(o=e;o<n;o+=r)a=S(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=S(o,t[o],t[o+1],a);return a&&x(a,a.next)&&(O(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!x(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(O(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,f,h){if(t){!h&&f&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,u,s,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,u=0,e=0;e<c&&(u++,r=r.nextZ);e++);for(s=c;u>0||s>0&&r;)0!==u&&(0===s||!r||n.z<=r.z)?(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,f);for(var v,y,d=t;t.prev!==t.next;)if(v=t.prev,y=t.next,f?s(t,r,i,f):u(t))e.push(v.i/n),e.push(t.i/n),e.push(y.i/n),O(t),t=y.next,d=y.next;else if((t=y)===d){h?1===h?a(t=c(o(t),e,n),e,n,r,i,f,2):2===h&&l(t,e,n,r,i,f):a(o(t),e,n,r,i,f,1);break}}}function u(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(d(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function s(t,e,n,r){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var u=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,s=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=p(u,s,e,n,r),h=p(c,l,e,n,r),v=t.prevZ,y=t.nextZ;v&&v.z>=f&&y&&y.z<=h;){if(v!==t.prev&&v!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==t.prev&&y!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=h;){if(y!==t.prev&&y!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!x(i,a)&&b(i,r,r.next,a)&&T(i,a)&&T(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),O(r),O(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,u){var s=t;do{for(var c=s.next.next;c!==s.prev;){if(s.i!==c.i&&m(s,c)){var l=E(s,c);return s=o(s,s.next),l=o(l,l.next),a(s,e,n,r,i,u),void a(l,e,n,r,i,u)}c=c.next}s=s.next}while(s!==t)}function f(t,e){return t.x-e.x}function h(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var u=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=i&&u>a){if(a=u,u===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var s,c=n,l=n.x,f=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&d(o<f?i:a,o,l,f,o<f?a:i,o,r.x,r.y)&&(s=Math.abs(o-r.y)/(i-r.x),T(r,t)&&(s<h||s===h&&(r.x>n.x||r.x===n.x&&v(n,r)))&&(n=r,h=s)),r=r.next}while(r!==c);return n}(t,e)){var n=E(e,t);o(e,e.next),o(n,n.next)}}function v(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function d(t,e,n,r,i,o,a,u){return(i-a)*(e-u)-(t-a)*(o-u)>=0&&(t-a)*(r-u)-(n-a)*(e-u)>=0&&(n-a)*(o-u)-(i-a)*(r-u)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(T(t,e)&&T(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||x(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){var i=k(g(t,e,n)),o=k(g(t,e,r)),a=k(g(n,r,t)),u=k(g(n,r,e));return i!==o&&a!==u||(!(0!==i||!w(t,n,e))||(!(0!==o||!w(t,r,e))||(!(0!==a||!w(n,t,r))||!(0!==u||!w(n,e,r)))))}function w(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function k(t){return t>0?1:t<0?-1:0}function T(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function E(t,e){var n=new _(t.i,t.x,t.y),r=new _(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(t,e,n,r){var i=new _(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function O(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(M(t,0,o,n));if(i)for(var u=0,s=e.length;u<s;u++){var c=e[u]*n,l=u<s-1?e[u+1]*n:t.length;a-=Math.abs(M(t,c,l,n))}var f=0;for(u=0;u<r.length;u+=3){var h=r[u]*n,v=r[u+1]*n,p=r[u+2]*n;f+=Math.abs((t[h]-t[p])*(t[v+1]-t[h+1])-(t[h]-t[v])*(t[p+1]-t[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},function(t,e,n){var r=n(33);globalThis.luma=globalThis.luma||{},t.exports=Object.assign(globalThis.luma,r)},function(t,e,n){var r=n(4);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new T(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=b(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var l={};function f(){}function h(){}function v(){}var p={};p[i]=function(){return this};var y=Object.getPrototypeOf,d=y&&y(y(E([])));d&&d!==e&&n.call(d,i)&&(p=d);var m=v.prototype=f.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=m.constructor=v,v.constructor=h,h.displayName=u(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(x.prototype),x.prototype[o]=function(){return this},t.AsyncIterator=x,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new x(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),u(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var s,c=[],l=!1,f=-1;function h(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&v())}function v(){if(!l){var t=u(h);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s&&s[f].run();f=-1,e=c.length}s=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||u(v)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}},function(t,e,n){var r=n(18);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){"use strict";n.r(e),n.d(e,"Display",(function(){return p})),n.d(e,"VRDisplay",(function(){return R})),n.d(e,"GLTFEnvironment",(function(){return Vt})),n.d(e,"createGLTFObjects",(function(){return _n})),n.d(e,"GLTFMaterialParser",(function(){return kn})),n.d(e,"GLTFAnimator",(function(){return mn})),n.d(e,"ScenegraphNode",(function(){return Be})),n.d(e,"GroupNode",(function(){return ze})),n.d(e,"ModelNode",(function(){return xn})),n.d(e,"buildHistopyramidBaseLevel",(function(){return Rn})),n.d(e,"getHistoPyramid",(function(){return In})),n.d(e,"histoPyramidGenerateIndices",(function(){return Ln})),n.d(e,"GPUPointInPolygon",(function(){return $n}));var r=n(5),i=n.n(r),o=n(2),a=n.n(o),u=n(3),s=n.n(u),c=n(0);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var p=function(){function t(){a()(this,t),this.animationLoop=null}return s()(t,[{key:"getViews",value:function(t){var e=t.width,n=t.height;return[{params:{viewport:[0,0,e,n],scissor:[0,0,e,n],scissorTest:!0}}]}},{key:"submitFrame",value:function(){return!0}},{key:"requestAnimationFrame",value:function(t){return!1}},{key:"delete",value:function(){}},{key:"_renderFrame",value:function(t){var e=this,n=this.getViews(t);if(!n)return!1;var r,i=this.animationLoop.gl,o=h(n);try{var a=function(){var n=r.value;Object(c.withParameters)(i,n.params,(function(){return e.animationLoop.onRender(f(f({},t),n))}))};for(o.s();!(r=o.n()).done;)a()}catch(t){o.e(t)}finally{o.f()}return this.submitFrame(),!0}}]),t}(),y=n(6),d=n.n(y),m=n(15),g=n.n(m),x=n(12),b=n.n(x),w=n(7),k=n.n(w),T=n(8),E=n.n(T),S=n(4),O=n.n(S),_=n(1),M=n.n(_);function P(t){var e=t.canvas,n=t.title,r=e.getBoundingClientRect(),i=r.top,o=r.left,a=r.width,u=r.height,s=document.createElement("div");s.style.position="absolute",s.style.top="".concat(i,"px"),s.style.left="".concat(o,"px"),s.style.width="".concat(a,"px"),s.style.height="".concat(u,"px"),s.style.pointerEvents="none",s.style.zIndex="999",document.body.appendChild(s);var c=document.createElement("button");return c.style.padding="16px",c.style.border="1px solid #fff",c.style.borderRadius="8px",c.style.background="rgba(0,0,0,0.5)",c.style.color="#fff",c.style.font="normal 20px sans-serif",c.style.cursor="pointer",c.style.margin="20px auto",c.style.display="block",c.style.pointerEvents="all",c.textContent=n,s.appendChild(c),c}function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var R=function(t){k()(r,t);var e,n=A(r);function r(t){var e;return a()(this,r),(e=n.call(this,t))._vrSupported=r.isSupported(),e._vrSupported&&(e.vrFrameData=new window.VRFrameData,e.vrPresenting=!1,e.vrFrame=!1,window.addEventListener("vrdisplaypresentchange",e._vrDisplayPresentChange.bind(g()(e)))),e}return s()(r,[{key:"delete",value:function(){b()(O()(r.prototype),"delete",this).call(this),this._removeVRButton()}},{key:"getViews",value:function(t){if(this._vrSupported&&this._addVRButton(),this.vrPresenting&&this.vrFrame){this.vrDisplay.getFrameData(this.vrFrameData);var e=this.vrFrameData,n=e.leftProjectionMatrix,i=e.leftViewMatrix,o=e.rightProjectionMatrix,a=e.rightViewMatrix,u=t.width,s=t.height;return[{displayEye:"left",projectionMatrix:n,viewMatrix:i,params:{viewport:[0,0,.5*u,s],scissor:[0,0,.5*u,s],scissorTest:!0}},{displayEye:"right",projectionMatrix:o,viewMatrix:a,params:{viewport:[.5*u,0,.5*u,s],scissor:[.5*u,0,.5*u,s],scissorTest:!0}}]}return b()(O()(r.prototype),"getViews",this).call(this,t)}},{key:"submitFrame",value:function(){return!(!this.vrPresenting||!this.vrFrame)&&(this.vrDisplay.submitFrame(),!0)}},{key:"requestAnimationFrame",value:function(t){var e=this;return!!this.vrPresenting&&(this.vrDisplay.requestAnimationFrame((function(){e.vrFrame=!0,t(),e.vrFrame=!1})),!0)}},{key:"_addVRButton",value:(e=d()(M.a.mark((function t(){var e,n,r=this;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.vrButton){t.next=2;break}return t.abrupt("return");case 2:if(e=this._getCanvas()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,navigator.getVRDisplays();case 7:(n=t.sent)&&n.length&&(c.log.info(2,"Found VR Displays",n)(),this.vrDisplay=n[0],this.vrButton=P({canvas:e,title:"Enter VR (".concat(this.vrDisplay.displayName,")")}),this.vrButton.onclick=function(){return r._startDisplay()});case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"_getCanvas",value:function(){return this.animationLoop.canvas||this.animationLoop.gl&&this.animationLoop.gl.canvas}},{key:"_removeVRButton",value:function(){this.vrButton}},{key:"_startDisplay",value:function(){this.vrDisplay.requestPresent([{source:this._getCanvas()}])}},{key:"_vrDisplayPresentChange",value:function(){this.vrDisplay.isPresenting?(c.log.info(2,"Entering VR")(),this.vrPresenting=!0,this.vrButton.style.display="none"):(c.log.info(2,"Exiting VR")(),this.vrPresenting=!1,this.vrButton.style.display="block")}}],[{key:"isSupported",value:function(){return"undefined"!=typeof navigator&&"getVRDisplays"in navigator&&"VRFrameData"in window}}]),r}(p);function I(t,e){if(!t)throw new Error(e||"loader assertion failed.")}var L=n(35),N=globalThis._parseImageNode,j="undefined"!=typeof Image,B="undefined"!=typeof ImageBitmap,C=Boolean(N),D=!!L.a||C;var F=n(10),z=n.n(F);function V(t){var e=G(t);if(!e)throw new Error("Not an image");return e}function U(t){return q(t)}function q(t){switch(V(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function G(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"===z()(t)&&t.data&&t.width&&t.height?"data":null}var Z=/^data:image\/svg\+xml/,X=/\.svg((\?|#).*)?$/;function H(t){return t&&(Z.test(t)||X.test(t))}function W(t,e){if(H(e)){var n=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(n=unescape(encodeURIComponent(n)))}catch(t){throw new Error(t.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return K(t,e)}function K(t,e){if(H(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function Y(t,e,n){return Q.apply(this,arguments)}function Q(){return(Q=d()(M.a.mark((function t(e,n,r){var i,o,a;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=W(e,r),o=self.URL||self.webkitURL,a="string"!=typeof i&&o.createObjectURL(i),t.prev=3,t.next=6,$(a||i,n);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,a&&o.revokeObjectURL(a),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function $(t,e){return J.apply(this,arguments)}function J(){return(J=d()(M.a.mark((function t(e,n){var r;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=new Image).src=e,!(n.image&&n.image.decode&&r.decode)){t.next=6;break}return t.next=5,r.decode();case 5:return t.abrupt("return",r);case 6:return t.next=8,new Promise((function(t,n){try{r.onload=function(){return t(r)},r.onerror=function(t){return n(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){n(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt={},et=!0;function nt(t,e,n){return rt.apply(this,arguments)}function rt(){return(rt=d()(M.a.mark((function t(e,n,r){var i,o,a;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!H(r)){t.next=7;break}return t.next=3,Y(e,n,r);case 3:o=t.sent,i=o,t.next=8;break;case 7:i=K(e,r);case 8:return a=n&&n.imagebitmap,t.next=11,it(i,a);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function it(t){return ot.apply(this,arguments)}function ot(){return(ot=d()(M.a.mark((function t(e){var n,r=arguments;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!at(n=r.length>1&&void 0!==r[1]?r[1]:null)&&et||(n=null),!n){t.next=13;break}return t.prev=3,t.next=6,createImageBitmap(e,n);case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(3),console.warn(t.t0),et=!1;case 13:return t.next=15,createImageBitmap(e);case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,null,[[3,9]])})))).apply(this,arguments)}function at(t){for(var e in t||tt)return!1;return!0}function ut(t){var e=st(t);return function(t){var e=st(t);if(!(e.byteLength>=24&&2303741511===e.getUint32(0,!1)))return null;return{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}(e)||function(t){var e=st(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,!1)&&255===e.getUint8(2)))return null;var n=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:n}}(),r=n.tableMarkers,i=n.sofMarkers,o=2;for(;o+9<e.byteLength;){var a=e.getUint16(o,!1);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,!1),width:e.getUint16(o+7,!1)};if(!r.has(a))return null;o+=2,o+=e.getUint16(o,!1)}return null}(e)||function(t){var e=st(t);if(!(e.byteLength>=10&&1195984440===e.getUint32(0,!1)))return null;return{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}}(e)||function(t){var e=st(t);if(!(e.byteLength>=14&&16973===e.getUint16(0,!1)&&e.getUint32(2,!0)===e.byteLength))return null;return{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}(e)}function st(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function ct(t,e){return lt.apply(this,arguments)}function lt(){return(lt=d()(M.a.mark((function t(e,n){var r,i,o;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=ut(e)||{},i=r.mimeType,I(o=globalThis._parseImageNode),t.next=5,o(e,i);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ft(t,e,n){return ht.apply(this,arguments)}function ht(){return(ht=d()(M.a.mark((function t(e,n,r){var i,o,a,u,s;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(n=n||{}).image||{},o=i.type||"auto",a=(r||{}).url,u=vt(o),t.t0=u,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,nt(e,n,a);case 10:return s=t.sent,t.abrupt("break",21);case 12:return t.next=14,Y(e,n,a);case 14:return s=t.sent,t.abrupt("break",21);case 16:return t.next=18,ct(e,n);case 18:return s=t.sent,t.abrupt("break",21);case 20:I(!1);case 21:return"data"===o&&(s=q(s)),t.abrupt("return",s);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vt(t){switch(t){case"auto":case"data":return function(){if(B)return"imagebitmap";if(j)return"image";if(D)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return B||j||D;case"imagebitmap":return B;case"image":return j;case"data":return D;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}var pt="",yt={};function dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function mt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function gt(t,e,n){var r=t;"function"==typeof t&&(r=t(mt(mt({},e),n))),I("string"==typeof r);var i=e.baseUrl;return i&&(r="/"===i[i.length-1]?"".concat(i).concat(r):"".concat(i,"/").concat(r)),function(t){for(var e in yt)if(t.startsWith(e)){var n=yt[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(pt).concat(t)),t}(r)}var xt=function(t){return t&&"object"===z()(t)};function bt(t,e){return wt.apply(this,arguments)}function wt(){return(wt=d()(M.a.mark((function t(e,n){var r,i=arguments;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},t.next=3,kt(e,n,r);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kt(t,e,n){return Tt.apply(this,arguments)}function Tt(){return(Tt=d()(M.a.mark((function t(e,n,r){var i;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e)){t.next=4;break}return t.next=3,Ot(e,n,r);case 3:return t.abrupt("return",t.sent);case 4:if(!xt(e)){t.next=8;break}return t.next=7,Et(e,n,r);case 7:return t.abrupt("return",t.sent);case 8:return i=e,t.next=11,n(i,r);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Et(t,e,n){return St.apply(this,arguments)}function St(){return(St=d()(M.a.mark((function t(e,n,r){var i,o,a,u;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(u in i=[],o={},a=function(t){var a=kt(e[t],n,r).then((function(e){o[t]=e}));i.push(a)},e)a(u);return t.next=6,Promise.all(i);case 6:return t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ot(t,e){return _t.apply(this,arguments)}function _t(){return(_t=d()(M.a.mark((function t(e,n){var r,i,o=arguments;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:{},i=e.map((function(t){return kt(t,n,r)})),t.next=4,Promise.all(i);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Mt(t,e,n){return Pt.apply(this,arguments)}function Pt(){return(Pt=d()(M.a.mark((function t(e,n,r){return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,bt(e,(function(t){return At(t,n,r)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function At(t,e,n){return Rt.apply(this,arguments)}function Rt(){return(Rt=d()(M.a.mark((function t(e,n,r){var i,o;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,r.fetch);case 2:return i=t.sent,t.next=5,i.arrayBuffer();case 5:return o=t.sent,t.next=8,n(o,r);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function It(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?It(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Nt(t){return jt.apply(this,arguments)}function jt(){return(jt=d()(M.a.mark((function t(e){var n,r,i=arguments;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},t.next=3,Bt(e,n);case 3:return r=t.sent,t.next=6,Mt(r,ft,n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Bt(t,e){return Ct.apply(this,arguments)}function Ct(){return(Ct=d()(M.a.mark((function t(e,n){var r,i,o=arguments;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:{},0===(i=n&&n.image&&n.image.mipLevels||0)){t.next=8;break}return t.next=5,Dt(e,i,n,r);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=gt(e,n,r);case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Dt(t,e,n,r){return Ft.apply(this,arguments)}function Ft(){return(Ft=d()(M.a.mark((function t(e,n,r,i){var o,a,u,s,c,l,f,h;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],"auto"!==n){t.next=9;break}return a=gt(e,r,Lt(Lt({},i),{},{lod:0})),t.next=5,At(a,ft,r);case 5:u=t.sent,s=U(u),c=s.width,l=s.height,n=zt({width:c,height:l}),o.push(a);case 9:for(I(n>0),f=o.length;f<n;++f)h=gt(e,r,Lt(Lt({},i),{},{lod:f})),o.push(h);return t.abrupt("return",o);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zt(t){var e=t.width,n=t.height;return 1+Math.floor(Math.log2(Math.max(e,n)))}var Vt=function(){function t(e,n){var r=n.brdfLutUrl,i=n.getTexUrl,o=n.specularMipLevels,u=void 0===o?10:o;a()(this,t),this.gl=e,this.brdfLutUrl=r,this.getTexUrl=i,this.specularMipLevels=u}return s()(t,[{key:"makeCube",value:function(t){var e=t.id,n=t.getTextureForFace,r=t.parameters,i={};return c.TextureCube.FACES.forEach((function(t){i[t]=n(t)})),new c.TextureCube(this.gl,{id:e,mipmaps:!1,parameters:r,pixels:i})}},{key:"getDiffuseEnvSampler",value:function(){var t,e=this;this._DiffuseEnvSampler||(this._DiffuseEnvSampler=this.makeCube({id:"DiffuseEnvSampler",getTextureForFace:function(t){return Nt(e.getTexUrl("diffuse",t,0))},parameters:(t={},i()(t,10242,33071),i()(t,10243,33071),i()(t,10241,9729),i()(t,10240,9729),t)}));return this._DiffuseEnvSampler}},{key:"getSpecularEnvSampler",value:function(){var t,e=this;this._SpecularEnvSampler||(this._SpecularEnvSampler=this.makeCube({id:"SpecularEnvSampler",getTextureForFace:function(t){for(var n=[],r=0;r<=e.specularMipLevels-1;r++)n.push(Nt(e.getTexUrl("specular",t,r)));return n},parameters:(t={},i()(t,10242,33071),i()(t,10243,33071),i()(t,10241,9987),i()(t,10240,9729),t)}));return this._SpecularEnvSampler}},{key:"getBrdfTexture",value:function(){var t;this._BrdfTexture||(this._BrdfTexture=new c.Texture2D(this.gl,{id:"brdfLUT",parameters:(t={},i()(t,10242,33071),i()(t,10243,33071),i()(t,10241,9729),i()(t,10240,9729),t),data:Nt(this.brdfLutUrl)}));return this._BrdfTexture}},{key:"delete",value:function(){this._DiffuseEnvSampler&&(this._DiffuseEnvSampler.delete(),this._DiffuseEnvSampler=null),this._SpecularEnvSampler&&(this._SpecularEnvSampler.delete(),this._SpecularEnvSampler=null),this._BrdfTexture&&(this._BrdfTexture.delete(),this._BrdfTexture=null)}}]),t}(),Ut=n(11),qt=n.n(Ut),Gt=(n(19),n(9)),Zt=n.n(Gt);function Xt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}Math.PI,Math.PI;var Ht={};function Wt(t){return Math.round(t/Ht.EPSILON)*Ht.EPSILON}function Kt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.precision,r=void 0===n?Ht.precision||4:n;return t=Wt(t),"".concat(parseFloat(t.toPrecision(r)))}function Yt(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Qt(t,e,n){var r=Ht.EPSILON;n&&(Ht.EPSILON=n);try{if(t===e)return!0;if(Yt(t)&&Yt(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Qt(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=Ht.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Ht.EPSILON=r}}function $t(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Jt(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function te(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(Ht.debug&&!$t(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}Ht.EPSILON=1e-12,Ht.debug=!1,Ht.precision=4,Ht.printTypes=!1,Ht.printDegrees=!1,Ht.printRowMajor=!0;var ee={};function ne(t,e){ee[t]||(ee[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var ie=function(t){k()(n,t);var e=re(n);function n(){return a()(this,n),e.apply(this,arguments)}return s()(n,[{key:"ELEMENTS",get:function(){return Xt(!1),0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Yt(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(Ht)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Kt(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Qt(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]+=o[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]-=o[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"elements",get:function(){return this}},{key:"check",value:function(){if(Ht.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}]),n}(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array));function oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var ae=function(t){k()(n,t);var e=oe(n);function n(){return a()(this,n),e.apply(this,arguments)}return s()(n,[{key:"ELEMENTS",get:function(){return Xt(!1),0}},{key:"RANK",get:function(){return Xt(!1),0}},{key:"toString",value:function(){var t="[";if(Ht.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=Jt(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,r=0;r<this.RANK;++r)e[r]=this[n+r];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,r=0;r<this.RANK;++r)this[n+r]=e[r];return this}}]),n}(ie);function ue(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o||1;return t[0]=(n[0]*r+n[4]*i+n[8]*o)/a,t[1]=(n[1]*r+n[5]*i+n[9]*o)/a,t[2]=(n[2]*r+n[6]*i+n[10]*o)/a,t}var se=1e-6,ce="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function le(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=e[9],v=e[10],p=e[11],y=e[12],d=e[13],m=e[14],g=e[15],x=n[0],b=n[1],w=n[2],k=n[3];return t[0]=x*r+b*u+w*f+k*y,t[1]=x*i+b*s+w*h+k*d,t[2]=x*o+b*c+w*v+k*m,t[3]=x*a+b*l+w*p+k*g,x=n[4],b=n[5],w=n[6],k=n[7],t[4]=x*r+b*u+w*f+k*y,t[5]=x*i+b*s+w*h+k*d,t[6]=x*o+b*c+w*v+k*m,t[7]=x*a+b*l+w*p+k*g,x=n[8],b=n[9],w=n[10],k=n[11],t[8]=x*r+b*u+w*f+k*y,t[9]=x*i+b*s+w*h+k*d,t[10]=x*o+b*c+w*v+k*m,t[11]=x*a+b*l+w*p+k*g,x=n[12],b=n[13],w=n[14],k=n[15],t[12]=x*r+b*u+w*f+k*y,t[13]=x*i+b*s+w*h+k*d,t[14]=x*o+b*c+w*v+k*m,t[15]=x*a+b*l+w*p+k*g,t}function fe(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function he(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}function ve(t,e,n,r){var i,o,a,u,s,c,l,f,h,v,p=e[0],y=e[1],d=e[2],m=r[0],g=r[1],x=r[2],b=n[0],w=n[1],k=n[2];return Math.abs(p-b)<se&&Math.abs(y-w)<se&&Math.abs(d-k)<se?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(l=p-b,f=y-w,h=d-k,i=g*(h*=v=1/Math.hypot(l,f,h))-x*(f*=v),o=x*(l*=v)-m*h,a=m*f-g*l,(v=Math.hypot(i,o,a))?(i*=v=1/v,o*=v,a*=v):(i=0,o=0,a=0),u=f*a-h*o,s=h*i-l*a,c=l*o-f*i,(v=Math.hypot(u,s,c))?(u*=v=1/v,s*=v,c*=v):(u=0,s=0,c=0),t[0]=i,t[1]=u,t[2]=l,t[3]=0,t[4]=o,t[5]=s,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=h,t[11]=0,t[12]=-(i*p+o*y+a*d),t[13]=-(u*p+s*y+c*d),t[14]=-(l*p+f*y+h*d),t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var pe,ye;pe=new ce(2),ce!=Float32Array&&(pe[0]=0,pe[1]=0),ye=pe;function de(){var t=new ce(3);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function me(t,e,n){var r=new ce(3);return r[0]=t,r[1]=e,r[2]=n,r}function ge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xe(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],u=n[1],s=n[2];return t[0]=i*s-o*u,t[1]=o*a-r*s,t[2]=r*u-i*a,t}function be(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}var we=function(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)};!function(){var t=de()}();function ke(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Te(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Ee(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*o-s*i,f=c*i+s*r-a*o,h=c*o+a*i-u*r,v=-a*r-u*i-s*o;return t[0]=l*c+v*-a+f*-s-h*-u,t[1]=f*c+v*-u+h*-a-l*-s,t[2]=h*c+v*-s+l*-u-f*-a,t[3]=e[3],t}!function(){var t=function(){var t=new ce(4);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();function Se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var Oe=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),_e=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Me=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Pe={},Ae=function(t){k()(n,t);var e=Se(n);function n(t){var r;return a()(this,n),r=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return s()(n,[{key:"INDICES",get:function(){return Me}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,r,i,o,a,u,s,c,l,f,h,v,p,y){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=u,this[8]=s,this[9]=c,this[10]=l,this[11]=f,this[12]=h,this[13]=v,this[14]=p,this[15]=y,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,o,a,u,s,c,l,f,h,v,p,y){return this[0]=t,this[1]=i,this[2]=s,this[3]=h,this[4]=e,this[5]=o,this[6]=c,this[7]=v,this[8]=n,this[9]=a,this[10]=l,this[11]=p,this[12]=r,this[13]=u,this[14]=f,this[15]=y,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(Oe)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,u=r+r,s=i+i,c=n*a,l=r*a,f=r*u,h=i*a,v=i*u,p=i*s,y=o*a,d=o*u,m=o*s;t[0]=1-f-p,t[1]=l+m,t[2]=h-d,t[3]=0,t[4]=l-m,t[5]=1-c-p,t[6]=v+y,t[7]=0,t[8]=h+d,t[9]=v-y,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,r=t.right,i=t.bottom,o=t.top,a=t.near,u=t.far;return u===1/0?n._computeInfinitePerspectiveOffCenter(this,e,r,i,o,a):function(t,e,n,r,i,o,a){var u=1/(n-e),s=1/(i-r),c=1/(o-a);t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(n+e)*u,t[9]=(i+r)*s,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0}(this,e,r,i,o,a,u),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var r=t;t=r.eye,e=r.center,n=r.up}return ve(this,t,e=e||[0,0,0],n=n||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,o=t.near,a=void 0===o?.1:o,u=t.far;return function(t,e,n,r,i,o,a){var u=1/(e-n),s=1/(r-i),c=1/(o-a);t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*u,t[13]=(i+r)*s,t[14]=(a+o)*c,t[15]=1}(this,e,n,r,i,a,void 0===u?500:u),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,r=void 0===e?45*Math.PI/180:e,i=t.aspect,o=void 0===i?1:i,a=t.focalDistance,u=void 0===a?1:a,s=t.near,c=void 0===s?.1:s,l=t.far,f=void 0===l?500:l;if(r>2*Math.PI)throw Error("radians");var h=r/2,v=u*Math.tan(h),p=v*o;return(new n).ortho({left:-p,right:p,bottom:-v,top:v,near:c,far:f})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=void 0===e?void 0:e,r=t.fov,i=void 0===r?45*Math.PI/180:r,o=t.aspect,a=void 0===o?1:o,u=t.near,s=void 0===u?.1:u,c=t.far,l=void 0===c?500:c;if((n=n||i)>2*Math.PI)throw Error("radians");return he(this,n,a,s,l),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8],l=t[9],f=t[10],h=t[11],v=t[12],p=t[13],y=t[14],d=t[15],(e*a-n*o)*(f*d-h*y)-(e*u-r*o)*(l*d-h*p)+(e*s-i*o)*(l*y-f*p)+(n*u-r*a)*(c*d-h*v)-(n*s-i*a)*(c*y-f*v)+(r*s-i*u)*(c*p-l*v);var t,e,n,r,i,o,a,u,s,c,l,f,h,v,p,y,d}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=e[9],h=e[10],v=e[11],p=e[12],y=e[13],d=e[14],m=e[15],g=n*u-r*a,x=n*s-i*a,b=n*c-o*a,w=r*s-i*u,k=r*c-o*u,T=i*c-o*s,E=l*y-f*p,S=l*d-h*p,O=l*m-v*p,_=f*d-h*y,M=f*m-v*y,P=h*m-v*d,A=g*P-x*M+b*_+w*O-k*S+T*E;A&&(A=1/A,t[0]=(u*P-s*M+c*_)*A,t[1]=(i*M-r*P-o*_)*A,t[2]=(y*T-d*k+m*w)*A,t[3]=(h*k-f*T-v*w)*A,t[4]=(s*O-a*P-c*S)*A,t[5]=(n*P-i*O+o*S)*A,t[6]=(d*b-p*T-m*x)*A,t[7]=(l*T-h*b+v*x)*A,t[8]=(a*M-u*O+c*E)*A,t[9]=(r*O-n*M-o*E)*A,t[10]=(p*k-y*b+m*g)*A,t[11]=(f*b-l*k-v*g)*A,t[12]=(u*S-a*_-s*E)*A,t[13]=(n*_-r*S+i*E)*A,t[14]=(y*x-p*w-d*g)*A,t[15]=(l*w-f*x+h*g)*A)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return le(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return le(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],l=e[9],f=e[10],h=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=u*i+f*r,t[7]=s*i+h*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=f*i-u*r,t[11]=h*i-s*r}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],u=e[2],s=e[3],c=e[8],l=e[9],f=e[10],h=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-l*r,t[2]=u*i-f*r,t[3]=s*i-h*r,t[8]=o*r+c*i,t[9]=a*r+l*i,t[10]=u*r+f*i,t[11]=s*r+h*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],u=e[2],s=e[3],c=e[4],l=e[5],f=e[6],h=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=u*i+f*r,t[3]=s*i+h*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=f*i-u*r,t[7]=h*i-s*r}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=qt()(t,3),n=e[0],r=e[1],i=e[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,n,r){var i,o,a,u,s,c,l,f,h,v,p,y,d,m,g,x,b,w,k,T,E,S,O,_,M=r[0],P=r[1],A=r[2],R=Math.hypot(M,P,A);R<se||(M*=R=1/R,P*=R,A*=R,i=Math.sin(n),a=1-(o=Math.cos(n)),u=e[0],s=e[1],c=e[2],l=e[3],f=e[4],h=e[5],v=e[6],p=e[7],y=e[8],d=e[9],m=e[10],g=e[11],x=M*M*a+o,b=P*M*a+A*i,w=A*M*a-P*i,k=M*P*a-A*i,T=P*P*a+o,E=A*P*a+M*i,S=M*A*a+P*i,O=P*A*a-M*i,_=A*A*a+o,t[0]=u*x+f*b+y*w,t[1]=s*x+h*b+d*w,t[2]=c*x+v*b+m*w,t[3]=l*x+p*b+g*w,t[4]=u*k+f*T+y*E,t[5]=s*k+h*T+d*E,t[6]=c*k+v*T+m*E,t[7]=l*k+p*T+g*E,t[8]=u*S+f*O+y*_,t[9]=s*S+h*O+d*_,t[10]=c*S+v*O+m*_,t[11]=l*S+p*O+g*_,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?fe(this,this,t):fe(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,n){var r,i,o,a,u,s,c,l,f,h,v,p,y=n[0],d=n[1],m=n[2];e===t?(t[12]=e[0]*y+e[4]*d+e[8]*m+e[12],t[13]=e[1]*y+e[5]*d+e[9]*m+e[13],t[14]=e[2]*y+e[6]*d+e[10]*m+e[14],t[15]=e[3]*y+e[7]*d+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=e[9],v=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=v,t[11]=p,t[12]=r*y+u*d+f*m+e[12],t[13]=i*y+s*d+h*m+e[13],t[14]=o*y+c*d+v*m+e[14],t[15]=a*y+l*d+p*m+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(te(e=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(e||[-0,-0],t,this);break;case 3:e=be(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return te(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1],o=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/o,t[1]=(n[1]*r+n[5]*i)/o,t}(e||[-0,-0],t,this);break;case 3:e=ue(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return te(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return ne("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return ne("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return ne("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"IDENTITY",get:function(){return Pe.IDENTITY=Pe.IDENTITY||Object.freeze(new n(Oe)),Pe.IDENTITY}},{key:"ZERO",get:function(){return Pe.ZERO=Pe.ZERO||Object.freeze(new n(_e)),Pe.ZERO}},{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,r,i,o){var a=2*o/(n-e),u=2*o/(i-r),s=(n+e)/(n-e),c=(i+r)/(i-r),l=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=s,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}}]),n}(ae);function Re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}function Ie(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var Le=[0,0,0],Ne={},je=function(t){k()(n,t);var e=Ie(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a()(this,n),t=e.call(this,-0,-0,-0),1===arguments.length&&Yt(r)?t.copy(r):(Ht.debug&&(Jt(r),Jt(i),Jt(o)),t[0]=r,t[1]=i,t[2]=o),t}return s()(n,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return Ht.debug&&(Jt(t.x),Jt(t.y),Jt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Jt(t)}},{key:"angle",value:function(t){return n=t,r=(e=this)[0],i=e[1],o=e[2],a=n[0],u=n[1],s=n[2],c=Math.sqrt(r*r+i*i+o*o)*Math.sqrt(a*a+u*u+s*s),l=c&&ge(e,n)/c,Math.acos(Math.min(Math.max(l,-1),1));var e,n,r,i,o,a,u,s,c,l}},{key:"cross",value:function(t){return xe(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Le:n,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Le:n,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Le:n,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return be(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return ue(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return function(t,e,n){var r=e[0],i=e[1],o=e[2];t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8]}(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,n){var r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],u=e[0],s=e[1],c=e[2],l=i*c-o*s,f=o*u-r*c,h=r*s-i*u,v=i*h-o*f,p=o*l-r*h,y=r*f-i*l,d=2*a;l*=d,f*=d,h*=d,v*=2,p*=2,y*=2,t[0]=u+l+v,t[1]=s+f+p,t[2]=c+h+y}(this,this,t),this.check()}}],[{key:"ZERO",get:function(){return Ne.ZERO=Ne.ZERO||Object.freeze(new n(0,0,0,0))}}]),n}(function(t){k()(n,t);var e=Re(n);function n(){return a()(this,n),e.apply(this,arguments)}return s()(n,[{key:"ELEMENTS",get:function(){return Xt(!1),0}},{key:"copy",value:function(t){return Xt(!1),this}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Jt(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Jt(t)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return Jt(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Jt(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]*=o[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]/=o[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),Jt(this[t])}},{key:"setComponent",value:function(t,e){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}]),n}(ie)),Be=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(this,t);var n=e.id;this.id=n||Object(c.uid)(this.constructor.name),this.display=!0,this.position=new je,this.rotation=new je,this.scale=new je(1,1,1),this.matrix=new Ae,this.userData={},this.props={},this._setScenegraphNodeProps(e)}return s()(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(t){return this._setScenegraphNodeProps(t),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"getBounds",value:function(){return null}},{key:"setPosition",value:function(t){return Object(c.assert)(3===t.length,"setPosition requires vector argument"),this.position=t,this}},{key:"setRotation",value:function(t){return Object(c.assert)(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}},{key:"setScale",value:function(t){return Object(c.assert)(3===t.length,"setScale requires vector argument"),this.scale=t,this}},{key:"setMatrix",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.matrix.copy(t):this.matrix=t}},{key:"setMatrixComponents",value:function(t){var e=t.position,n=t.rotation,r=t.scale,i=t.update,o=void 0===i||i;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),o&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.position,n=t.rotation,r=t.scale;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(t,e){Object(c.assert)(t),e=e||this.matrix;var n=new Ae(t).multiplyRight(e),r=n.invert(),i=r.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:i}}},{key:"_setScenegraphNodeProps",value:function(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}]),t}();function Ce(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return De(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return De(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function De(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var ze=function(t){k()(n,t);var e=Fe(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(this,n);var i=r=Array.isArray(r)?{children:r}:r,o=i.children,u=void 0===o?[]:o;return c.log.assert(u.every((function(t){return t instanceof Be})),"every child must an instance of ScenegraphNode"),(t=e.call(this,r)).children=u,t}return s()(n,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];Array.isArray(o)?this.add.apply(this,Zt()(o)):this.children.push(o)}return this}},{key:"remove",value:function(t){var e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach((function(t){return t.delete()})),this.removeAll(),b()(O()(n.prototype),"delete",this).call(this)}},{key:"getBounds",value:function(){var t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((function(e,n){var r=n.worldMatrix,i=e.getBounds();if(i){var o=qt()(i,2),a=o[0],u=o[1],s=new je(a).add(u).divide([2,2,2]);r.transformAsPoint(s,s);var c=new je(u).subtract(a).divide([2,2,2]);r.transformAsVector(c,c);for(var l=0;l<8;l++)for(var f=new je(1&l?-1:1,2&l?-1:1,4&l?-1:1).multiply(c).add(s),h=0;h<3;h++)t[0][h]=Math.min(t[0][h],f[h]),t[1][h]=Math.max(t[1][h],f[h])}})),Number.isFinite(t[0][0])?t:null}},{key:"traverse",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.worldMatrix,o=void 0===i?new Ae:i,a=new Ae(o).multiplyRight(this.matrix),u=Ce(this.children);try{for(u.s();!(e=u.n()).done;){var s=e.value;s instanceof n?s.traverse(t,{worldMatrix:a}):t(s,{worldMatrix:a})}}catch(t){u.e(t)}finally{u.f()}}}]),n}(Be);function Ve(){var t=new ce(4);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ue(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function qe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],u=n[0],s=n[1],c=n[2],l=n[3];return t[0]=r*l+a*u+i*c-o*s,t[1]=i*l+a*s+o*u-r*c,t[2]=o*l+a*c+r*s-i*u,t[3]=a*l-r*u-i*s-o*c,t}function Ge(t,e,n,r){var i,o,a,u,s,c=e[0],l=e[1],f=e[2],h=e[3],v=n[0],p=n[1],y=n[2],d=n[3];return(o=c*v+l*p+f*y+h*d)<0&&(o=-o,v=-v,p=-p,y=-y,d=-d),1-o>se?(i=Math.acos(o),a=Math.sin(i),u=Math.sin((1-r)*i)/a,s=Math.sin(r*i)/a):(u=1-r,s=r),t[0]=u*c+s*v,t[1]=u*l+s*p,t[2]=u*f+s*y,t[3]=u*h+s*d,t}function Ze(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}var Xe,He,We,Ke,Ye,Qe,$e=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Je=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},tn=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},en=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],u=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=u+r*(n[3]-u),t},nn=ke,rn=Te,on=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t},an=(Xe=de(),He=me(1,0,0),We=me(0,1,0),function(t,e,n){var r=ge(e,n);return r<-.999999?(xe(Xe,He,e),we(Xe)<1e-6&&xe(Xe,We,e),function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o}(Xe,Xe),Ue(t,Xe,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(xe(Xe,e,n),t[0]=Xe[0],t[1]=Xe[1],t[2]=Xe[2],t[3]=1+r,on(t,t))});Ke=Ve(),Ye=Ve(),Qe=function(){var t=new ce(9);return ce!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();function un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var sn=[0,0,0,1],cn=function(t){k()(n,t);var e=un(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return a()(this,n),t=e.call(this,-0,-0,-0,-0),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,o,u),t}return s()(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}},{key:"fromMatrix3",value:function(t){return Ze(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return Ue(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Jt(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Jt(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Jt(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=Jt(t)}},{key:"len",value:function(){return nn(this)}},{key:"lengthSquared",value:function(){return rn(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return tn(this,t)}},{key:"rotationTo",value:function(t,e){return an(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return $e(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2];t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,u=a?1/a:0;t[0]=-n*u,t[1]=-r*u,t[2]=-i*u,t[3]=o*u}(this,this),this.check()}},{key:"lerp",value:function(t,e,n){return en(this,t,e,n),this.check()}},{key:"multiplyRight",value:function(t,e){return Xt(!e),qe(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return Xt(!e),qe(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(n),s=Math.cos(n);t[0]=r*s+a*u,t[1]=i*s+o*u,t[2]=o*s-i*u,t[3]=a*s-r*u}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(n),s=Math.cos(n);t[0]=r*s-o*u,t[1]=i*s+a*u,t[2]=o*s+r*u,t[3]=a*s-i*u}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(n),s=Math.cos(n);t[0]=r*s+i*u,t[1]=i*s-r*u,t[2]=o*s+a*u,t[3]=a*s-o*u}(this,this,t),this.check()}},{key:"scale",value:function(t){return Je(this,this,t),this.check()}},{key:"slerp",value:function(t,e,n){switch(arguments.length){case 1:var r=arguments[0],i=r.start;t=void 0===i?sn:i,e=r.target,n=r.ratio;break;case 2:var o=Array.prototype.slice.call(arguments);e=o[0],n=o[1],t=this}return Ge(this,t,e,n),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return Ee(e,t,this),te(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}}]),n}(ie),ln={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function hn(t){if(!t._animation){var e=fn[t.componentType],n=ln[t.type],r=n*t.count,i=t.bufferView.data,o=new e(i.buffer,i.byteOffset+(t.byteOffset||0),r);if(1===n)t._animation=Array.from(o);else{for(var a=[],u=0;u<o.length;u+=n)a.push(Array.from(o.slice(u,u+n)));t._animation=a}}return t._animation}var vn=new Ae;var pn=new cn;function yn(t,e,n,r){var i=e.input,o=e.interpolation,a=e.output,u=t%i[i.length-1],s=i.findIndex((function(t){return t>=u})),l=Math.max(0,s-1);if(!Array.isArray(n[r]))switch(r){case"translation":n[r]=[0,0,0];break;case"rotation":n[r]=[0,0,0,1];break;case"scale":n[r]=[1,1,1];break;default:c.log.warn("Bad animation path ".concat(r))()}Object(c.assert)(n[r].length===a[l].length);var f=i[l],h=i[s];switch(o){case"STEP":!function(t,e,n){for(var r=0;r<n.length;r++)t[e][r]=n[r]}(n,r,a[l]);break;case"LINEAR":if(h>f){var v=(u-f)/(h-f);!function(t,e,n,r,i){if("rotation"===e){pn.slerp({start:n,target:r,ratio:i});for(var o=0;o<pn.length;o++)t[e][o]=pn[o]}else for(var a=0;a<n.length;a++)t[e][a]=i*r[a]+(1-i)*n[a]}(n,r,a[l],a[s],v)}break;case"CUBICSPLINE":if(h>f){var p=(u-f)/(h-f),y=h-f;!function(t,e,n){for(var r=n.p0,i=n.outTangent0,o=n.inTangent1,a=n.p1,u=n.tDiff,s=n.ratio,c=0;c<t[e].length;c++){var l=i[c]*u,f=o[c]*u;t[e][c]=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*r[c]+(Math.pow(s,3)-2*Math.pow(s,2)+s)*l+(-2*Math.pow(s,3)+3*Math.pow(s,2))*a[c]+(Math.pow(s,3)-Math.pow(s,2))*f}}(n,r,{p0:a[3*l+1],outTangent0:a[3*l+2],inTangent1:a[3*s+0],p1:a[3*s+1],tDiff:y,ratio:p})}break;default:c.log.warn("Interpolation ".concat(o," not supported"))()}}var dn=function(){function t(e){a()(this,t),this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}return s()(t,[{key:"animate",value:function(t){if(this.playing){var e=(t/1e3-this.startTime)*this.speed;this.channels.forEach((function(t){var n=t.sampler,r=t.target,i=t.path;yn(e,n,r,i),function(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){var n=vn.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}(r,r._node)}))}}}]),t}(),mn=function(){function t(e){a()(this,t),this.animations=e.animations.map((function(t,n){var r=t.name||"Animation-".concat(n),i=t.samplers.map((function(t){var n=t.input,r=t.interpolation,i=void 0===r?"LINEAR":r,o=t.output;return{input:hn(e.accessors[n]),interpolation:i,output:hn(e.accessors[o])}})),o=t.channels.map((function(t){var n=t.sampler,r=t.target;return{sampler:i[n],target:e.nodes[r.node],path:r.path}}));return new dn({name:r,channels:o})}))}return s()(t,[{key:"animate",value:function(t){this.setTime(t)}},{key:"setTime",value:function(t){this.animations.forEach((function(e){return e.animate(t)}))}},{key:"getAnimations",value:function(){return this.animations}}]),t}();function gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var xn=function(t){k()(n,t);var e=gn(n);function n(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a()(this,n),(r=e.call(this,i)).onBeforeRender=null,r.AfterRender=null,t instanceof c.Model?(r.model=t,r._setModelNodeProps(i)):r.model=new c.Model(t,i),r.bounds=null,r.managedResources=i.managedResources||[],r}return s()(n,[{key:"setProps",value:function(t){return b()(O()(n.prototype),"setProps",this).call(this,t),this._setModelNodeProps(t),this}},{key:"getBounds",value:function(){return this.bounds}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach((function(t){return t.delete()})),this.managedResources=[]}},{key:"draw",value:function(){var t;return(t=this.model).draw.apply(t,arguments)}},{key:"setUniforms",value:function(){var t;return(t=this.model).setUniforms.apply(t,arguments),this}},{key:"setAttributes",value:function(){var t;return(t=this.model).setAttributes.apply(t,arguments),this}},{key:"updateModuleSettings",value:function(){var t;return(t=this.model).updateModuleSettings.apply(t,arguments),this}},{key:"_setModelNodeProps",value:function(t){this.model.setProps(t)}}]),n}(Be);function bn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bn(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var kn=function(){function t(e,n){var r=n.attributes,i=n.material,o=n.pbrDebug,u=n.imageBasedLightingEnvironment,s=n.lights,l=n.useTangents;a()(this,t),this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Object(c.hasFeature)(e,c.FEATURES.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],u&&(this.uniforms.u_DiffuseEnvSampler=u.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=u.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=u.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&l,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(u,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),i&&this.parseMaterial(i)}return s()(t,[{key:"defineIfPresent",value:function(t,e){t&&(this.defines[e]=1)}},{key:"parseTexture",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},a=t.texture.source.image,u={};a.compressed?(n=a,u=i()({},this.gl.TEXTURE_MIN_FILTER,a.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR)):n={data:a};var s=new c.Texture2D(this.gl,wn({id:t.name||t.id,parameters:wn(wn({},o),u),pixelStore:i()({},this.gl.UNPACK_FLIP_Y_WEBGL,!1)},n));this.uniforms[e]=s,this.defineIfPresent(r,r),this.generatedTextures.push(s)}},{key:"parsePbrMetallicRoughness",value:function(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");var e=t.metallicFactor,n=void 0===e?1:e,r=t.roughnessFactor,i=void 0===r?1:r;this.uniforms.u_MetallicRoughnessValues=[n,i]}},{key:"parseMaterial",value:function(t){if(this.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");var e=t.normalTexture.scale,n=void 0===e?1:e;this.uniforms.u_NormalScale=n}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");var r=t.occlusionTexture.strength,i=void 0===r?1:r;this.uniforms.u_OcclusionStrength=i}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),"MASK"===t.alphaMode){var o=t.alphaCutoff,a=void 0===o?.5:o;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=a}else"BLEND"===t.alphaMode&&(c.log.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}},{key:"delete",value:function(){this.generatedTextures.forEach((function(t){return t.delete()}))}}]),t}();function Tn(t,e){return Object(c.isWebGL2)(t)?"#version 300 es\n".concat(e):e}var En={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sn={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},On=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a()(this,t),this.gl=e,this.options=Object.assign({},Sn,n)}return s()(t,[{key:"instantiate",value:function(t){var e=this;return this.gltf=t,(t.scenes||[]).map((function(t){return e.createScene(t)}))}},{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new mn(this.gltf):null}},{key:"createScene",value:function(t){var e=this,n=(t.nodes||[]).map((function(t){return e.createNode(t)}));return new ze({id:t.name||t.id,children:n})}},{key:"createNode",value:function(t){var e=this;if(!t._node){var n=(t.children||[]).map((function(t){return e.createNode(t)}));t.mesh&&n.push(this.createMesh(t.mesh));var r=new ze({id:t.name||t.id,children:n});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){var i=(new Ae).fromQuaternion(t.rotation);r.matrix.multiplyRight(i)}t.scale&&r.matrix.scale(t.scale)}t._node=r}return t._node}},{key:"createMesh",value:function(t){var e=this;if(!t._mesh){var n=(t.primitives||[]).map((function(n,r){return e.createPrimitive(n,r,t)})),r=new ze({id:t.name||t.id,children:n});t._mesh=r}return t._mesh}},{key:"getVertexCount",value:function(t){c.log.warn("getVertexCount() not found")()}},{key:"createPrimitive",value:function(t,e,n){var r=function(t,e){var n=e.id,r=e.drawMode,i=e.vertexCount,o=e.attributes,a=e.modelOptions,u=new kn(t,e);c.log.info(4,"createGLTFModel defines: ",u.defines)();var s=[];s.push.apply(s,Zt()(u.generatedTextures)),s.push.apply(s,Zt()(Object.values(o).map((function(t){return t.buffer}))));var l=new xn(t,Object.assign({id:n,drawMode:r,vertexCount:i,modules:[c.pbr],defines:u.defines,parameters:u.parameters,vs:Tn(t,"\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n"),fs:Tn(t,"\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n"),managedResources:s},a));return l.setProps({attributes:o}),l.setUniforms(u.uniforms),l}(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return r.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],r}},{key:"createAttributes",value:function(t,e){var n=this,r={};return Object.keys(t).forEach((function(e){r[e]=n.createAccessor(t[e],n.createBuffer(t[e],n.gl.ARRAY_BUFFER))})),e&&(r.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),c.log.info(4,"glTF Attributes",{attributes:t,indices:e,generated:r})(),r}},{key:"createBuffer",value:function(t,e){t.bufferView||(t.bufferView={});var n=t.bufferView;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new c.Buffer(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}},{key:"createAccessor",value:function(t,e){return new c.Accessor({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:En[t.type]})}},{key:"createSampler",value:function(t){return t}},{key:"needsPOT",value:function(){return!1}}]),t}();function _n(t,e,n){var r=new On(t,n);return{scenes:r.instantiate(e),animator:r.createAnimator()}}var Mn="// Get current pixel indices for a given size\nvec2 histoPyramid_getPixelIndices(vec2 size) {\n  vec2 pixelOffset = transform_getPixelSizeHalf(size);\n  vec2 pixelIndices = transform_getPixelIndices(size, pixelOffset);\n  return pixelIndices;\n}\n\n// returns the top left texture coordiante corresponding to 2X2 block in higher level texture.\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec2 histoPyramid_getTexCoord(vec2 size, vec2 scale, vec2 offset) {\n  // use actual (scaled) texture size to calcualte offset (multiplied by scale)\n  vec2 scaledSize = size * scale;\n\n  // use minified texture size to find corresponding pixel index in out texture\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n\n  // now scale the indices to point to correct 2X2 block\n  pixelIndices = pixelIndices * scale;\n\n  // generate tex coordinate using actual size\n  vec2 texCoord = pixelIndices / scaledSize;\n  vec2 inPixelOffset = transform_getPixelSizeHalf(scaledSize);\n\n  return texCoord + (offset / scaledSize) + inPixelOffset;\n}\n\n// returns pixel value from higher level texture based on scale and offset\n// texSampler: higher level texture sampler\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec4 histoPyramid_getInput(sampler2D texSampler, vec2 size, vec2 scale, vec2 offset) {\n  vec2 texCoord = histoPyramid_getTexCoord(size, scale, offset);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n";function Pn(t){var e=Math.ceil(Math.log2(t));return Math.pow(2,e)}var An={r:0,x:0,g:1,y:1,b:2,z:2,a:3,w:3};function Rn(t,e){var n,r,o=e.texture,a=e.channel,u=void 0===a?"r":a,s=e._readData,l=void 0!==s&&s,f=o.width,h=o.height,v=((f=Pn(f))>(h=Pn(h))?f:h)/2,p=Object(c.cloneTextureFrom)(o,{width:v,height:v}),y=new c.Transform(t,{_sourceTextures:{inTexture:o},_targetTexture:p,_targetTextureVarying:"outTexture",vs:"".concat(Mn).concat("attribute vec4 inTexture;\nvarying vec4 outTexture;\nuniform int channel;\nuniform vec4 padingPixelValue;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  // vec2 scale = vec2(2., 2.);\n  vec2 scale = transform_uSize_inTexture / transform_uSize_outTexture;\n\n  // Verify if reference to a input texture pixel is out of bounds, if so treat the pixel as (0, 0)\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n  // now scale the indices padded size to point to correct 2X2 block\n  pixelIndices = pixelIndices * vec2(2, 2);\n\n  vec2 baseLevelSize = transform_uSize_inTexture;\n\n  // For all pixels outside of original texture size, return paddingPixelValue\n  bool xInside = pixelIndices.x < baseLevelSize.x;\n  bool yInside = pixelIndices.y < baseLevelSize.y;\n  bool xPlusOneInside = pixelIndices.x + 1. < baseLevelSize.x;\n  bool yPlusOneInside = pixelIndices.y + 1. < baseLevelSize.y;\n\n  vec4 pixel = (xInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0))\n    : padingPixelValue;\n\n  vec4 rightPixel = (xPlusOneInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0))\n    : padingPixelValue;\n\n  vec4 topPixel = (xInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1))\n    : padingPixelValue;\n\n  vec4 rightTopPixel = (xPlusOneInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1))\n    : padingPixelValue;\n\n  if (channel == 0) {\n    outTexture = vec4(pixel.r, rightPixel.r, topPixel.r, rightTopPixel.r);\n  }\n  if (channel == 1) {\n    outTexture = vec4(pixel.g, rightPixel.g, topPixel.g, rightTopPixel.g);\n  }\n  if (channel == 2) {\n    outTexture = vec4(pixel.b, rightPixel.b, topPixel.b, rightTopPixel.b);\n  }\n  if (channel == 3) {\n    outTexture = vec4(pixel.a, rightPixel.a, topPixel.a, rightTopPixel.a);\n  }\n}\n"),elementCount:p.width*p.height});y.run({uniforms:{channel:An[u]||0,padingPixelValue:[0,0,0,0]}}),(l||1===v)&&(r=y.getData({packed:!0}));var d=2*v,m=Object(c.cloneTextureFrom)(o,{width:d,height:d,parameters:(n={},i()(n,10240,9728),i()(n,10241,9728),n)}),g=y.getFramebuffer();return Object(c.copyToTexture)(g,m,{targetX:0,width:v,height:v}),{textureData:r,baseTexture:p,flatPyramidTexture:m}}function In(t,e){var n=Rn(t,e),r=n.textureData,i=n.baseTexture,o=n.flatPyramidTexture,a=i.width,u=Math.log2(a)+1,s=[i],l=r;if(u>1){for(var f=1;f<u;f++){var h=a/Math.pow(2,f);s.push(Object(c.cloneTextureFrom)(i,{width:h,height:h}))}for(var v=new c.Transform(t,{_sourceTextures:{inTexture:s[0]},_targetTexture:s[1],_targetTextureVarying:"outTexture",vs:"".concat(Mn).concat("attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  vec2 scale = vec2(2., 2.);\n  vec4 pixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0));\n  vec4 rightPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0));\n  vec4 bottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1));\n  vec4 rightBottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1));\n  // outTexture = pixel + rightPixel + bottomPixel + rightBottomPixel;\n  outTexture = vec4(\n    pixel.r + pixel.g + pixel.b + pixel.a,\n    rightPixel.r + rightPixel.g + rightPixel.b + rightPixel.a,\n    bottomPixel.r + bottomPixel.g + bottomPixel.b + bottomPixel.a,\n    rightBottomPixel.r + rightBottomPixel.g + rightBottomPixel.b + rightBottomPixel.a\n  );\n}\n"),elementCount:s[1].width*s[1].height}),p=a,y=1;y<u;y++){var d=[s[y].width,s[y].height];v.update({_sourceTextures:{inTexture:s[y-1]},_targetTexture:s[y],elementCount:s[y].width*s[y].height}),v.run();var m=v.getFramebuffer();Object(c.copyToTexture)(m,o,{targetX:p,width:d[0],height:d[1]}),p+=d[0]}l=v.getData()}return{pyramidTextures:s,flatPyramidTexture:o,levelCount:u,topLevelData:l}}function Ln(t,e){var n=In(t,e),r=n.flatPyramidTexture,i=n.levelCount,o=n.topLevelData,a=o[0]+o[1]+o[2]+o[3],u=new c.Buffer(t,new Float32Array(a).map((function(t,e){return e}))),s=new c.Buffer(t,4*a*4);return new c.Transform(t,{sourceBuffers:{keyIndex:u},_sourceTextures:{flatPyramidTexture:r},feedbackBuffers:{locationAndIndex:s},varyings:["locationAndIndex"],vs:"".concat("// Check 2X2 texture block to find relative index the given key index falls into\n// 2X2 block is represented by a single RGBA weight\nint histopyramid_traversal_findRangeIndex(float currentKey, vec4 weights, out float lowerBound) {\n  lowerBound = 0.;\n  float higherBound = 0.;\n  int relativeIndex = 0;\n  for (int i = 0; i < 4; i++) {\n    higherBound = lowerBound + weights[i];\n    relativeIndex = i;\n    if (currentKey >= lowerBound && currentKey < higherBound) {\n      break;\n    }\n    lowerBound = higherBound;\n  }\n  return relativeIndex;\n}\n\n// Maps index in 2X2 block to texture coordiante\n// Assumes the traversal order of lower-left -> lower->right -> upper-left -> upper->right\nvec2 histopyramid_traversal_mapIndexToCoord(int index) {\n  // relativeIndex ->  relativeCoordiante\n  // 0 -> (0, 0)\n  // 1 -> (1, 0)\n  // 2 -> (0, 1)\n  // 3 -> (1, 1)\n  float relativeX = mod(float(index), 2.);\n  float relativeY = (index > 1) ? 1. : 0.;\n  return vec2(relativeX, relativeY);\n}\n\n// Reads weight value from flat histopyramid\nvec4 histopyramid_traversal_getWeight(sampler2D flatPyramid, vec2 size, int level, int numLevels, vec2 offset) {\n  // horizontal offset in flat pyramid for current level\n  float xOffset = pow(2., float(numLevels)) - pow(2., float(numLevels - level));\n  vec2 lowerLeft = vec2(xOffset, 0.);\n  vec2 pixelIndices = lowerLeft + offset;\n\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 coord = pixelIndices / size + pixelSizeHalf;\n\n  return texture2D(flatPyramid, coord);\n}\n").concat("attribute float keyIndex;\nattribute vec4 flatPyramidTexture;\nvarying vec4 locationAndIndex;\nconst int MAX_LEVELS = 12; // assuming max texture size of 4K\n\nuniform int numLevels;\n\nvoid main()\n{\n  vec2 p = vec2(0., 0.);\n  float currentKey = keyIndex;\n  // for(int level = numLevels - 1; level <= 0; level--) {\n  for(int i = 1; i <= MAX_LEVELS; i++) {\n    int level = numLevels - i;\n    // #1. Get the current pixel values based on current level and current p\n    vec4 weights = histopyramid_traversal_getWeight(transform_uSampler_flatPyramidTexture, transform_uSize_flatPyramidTexture, level, numLevels, p);\n\n    // #2. Check the all weights in current 2X2 (4 values in RGBA channels) and determine the relative coordinate\n    float lowerBound = 0.;\n    int relativeIndex = histopyramid_traversal_findRangeIndex(currentKey, weights, lowerBound);\n    vec2 relativeCoord = histopyramid_traversal_mapIndexToCoord(relativeIndex);\n\n    //#3. Update P and key-index\n    p = 2.0 * p + relativeCoord;\n    currentKey -= lowerBound;\n    if (level == 0) { break; } // Work around for const expression restriction on for loops\n  }\n  locationAndIndex = vec4(p, currentKey, keyIndex);\n}\n"),elementCount:a}).run({uniforms:{numLevels:i}}),{locationAndIndexBuffer:s}}var Nn={name:"texture-filter",vs:"\nuniform vec4 textureFilter_uBoundingBox; //[xMin, yMin, xSize, ySize]\nuniform sampler2D textureFilter_uTexture;\nvec2 textureFilter_filter(vec2 position) {\n  vec2 filterValueIndex;\n  // Transfrom 'pos' to texture coordinate\n  vec2 pos = position - textureFilter_uBoundingBox.xy;\n  pos = pos / textureFilter_uBoundingBox.zw;\n  filterValueIndex.y = float(gl_VertexID);\n  if (pos.x < 0. || pos.x > 1. || pos.y < 0. || pos.y > 1.) {\n    filterValueIndex.x = -1.;\n  } else {\n    // Red channel is ID, Green channel inside/outside polygon\n    vec4 color = texture(textureFilter_uTexture, pos.xy);\n    filterValueIndex.x = color.g > 0. ? color.r : -1.;\n  }\n  return filterValueIndex;\n}\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};if(t.boundingBox){var n=qt()(t.boundingBox,4),r=n[0],i=n[1],o=n[2],a=n[3];e.textureFilter_uBoundingBox=[r,i,o-r,a-i]}return t.texture&&(e.textureFilter_uTexture=t.texture),e}},jn=n(20),Bn=n.n(jn);function Cn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Dn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Dn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Fn=Math.PI/4,zn=Math.PI/360;function Vn(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Un(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function qn(t){var e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function Gn(t,e,n,r){for(var i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function Zn(t,e,n,r){for(var i=e,o=n.length,a=0;a<o;a++)for(var u=0;u<r;u++)t[i++]=n[a][u]||0;if(!qn(n))for(var s=0;s<r;s++)t[i++]=n[0][s]||0;return i}function Xn(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=(o=o||n.length)-i;if(a<=0)return e;for(var u=e,s=0;s<a;s++)t[u++]=n[i+s];if(!Gn(n,r,i,o))for(var c=0;c<r;c++)t[u++]=n[i+c];return u}function Hn(t){return(qn(t)?0:1)+t.length}function Wn(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return n>=(r=r||t.length)?0:(Gn(t,e,n,r)?0:1)+(r-n)/e}function Kn(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!n)return(t=t.positions||t).length/e;if(Vn(t),t.positions){var r=t,i=r.positions,o=r.holeIndices;if(o){for(var a=0,u=0;u<=o.length;u++)a+=Wn(t.positions,e,o[u-1],o[u]);return a}t=i}if(Number.isFinite(t[0]))return Wn(t,e);if(!Un(t)){var s,c=0,l=Cn(t);try{for(l.s();!(s=l.n()).done;){var f=s.value;c+=Hn(f)}}catch(t){l.e(t)}finally{l.f()}return c}return Hn(t)}function Yn(t,e,n){Vn(t),n=n||Kn(t,e);var r=new Float64Array(n*e),i=[];if(t.positions){var o=t,a=o.positions,u=o.holeIndices;if(u){for(var s=0,c=0;c<=u.length;c++)s=Xn(r,s,a,e,u[c-1],u[c]),i.push(s);return i.pop(),{positions:r,holeIndices:i}}t=a}if(Number.isFinite(t[0]))return Xn(r,0,t,e),r;if(!Un(t)){var l,f=0,h=Cn(t);try{for(h.s();!(l=h.n()).done;){f=Zn(r,f,l.value,e),i.push(f)}}catch(t){h.e(t)}finally{h.f()}return i.pop(),{positions:r,holeIndices:i}}return Zn(r,0,t,e),r}function Qn(t,e,n){var r=null;t.holeIndices&&(r=t.holeIndices.map((function(t){return t/e})));var i=t.positions||t;if(n){var o=i.length;i=i.slice();for(var a=0;a<o;a+=e){var u=i[a+1];i[a+1]=Math.log(Math.tan(Fn+u*zn))}}return Bn()(i,r,e)}var $n=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a()(this,t),this.gl=e,Object(c.assert)(Object(c.isWebGL2)(e)),this.textureSize=512,this._setupResources(),this.update(n)}return s()(t,[{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.polygons,n=t.textureSize;if(n&&(this.textureSize=n),e&&0!==e.length){var r=Jn(e),i=r.vertices,o=r.indices,a=r.vertexCount,u=r.ids;this._updateResources(i,o,u,a)}}},{key:"filter",value:function(t){var e=t.positionBuffer,n=t.filterValueIndexBuffer,r=t.count;this.filterTransform.update({sourceBuffers:{a_position:e},feedbackBuffers:{filterValueIndex:n},elementCount:r});var i=this.polygonTexture,o=this.boundingBox;this.filterTransform.run({moduleSettings:{boundingBox:o,texture:i}})}},{key:"_setupResources",value:function(){var t,e=this.gl;this.polygonTexture=new c.Texture2D(e,{format:6407,type:5121,dataFormat:6407,border:0,mipmaps:!1,parameters:(t={},i()(t,10240,9728),i()(t,10241,9728),i()(t,10242,33071),i()(t,10243,33071),t)}),this.positionBuffer=new c.Buffer(e,{accessor:{type:5126,size:2}}),this.idBuffer=new c.Buffer(e,{accessor:{type:5126,size:1}}),this.indexBuffer=new c.Buffer(e,{target:34963,accessor:{type:5123}}),this.polyTextureTransform=new c.Transform(e,{id:"polygon-texture-creation-transform",elementCount:0,_targetTexture:this.polygonTexture,_targetTextureVarying:"v_polygonColor",vs:"uniform vec4 boundingBoxOriginSize; //[xMin, yMin, xSize, ySize]\nattribute vec2 a_position;\nattribute float a_polygonID;\nvarying vec4 v_polygonColor;\nvoid main()\n{\n    // translate from bbox to NDC\n    vec2 pos = a_position - boundingBoxOriginSize.xy;\n    pos = pos / boundingBoxOriginSize.zw;\n    pos = pos * 2.0 - vec2(1.0);\n    gl_Position = vec4(pos, 0.0, 1.0);\n    v_polygonColor = vec4(a_polygonID, 1.0, 1.0, 1.0);\n}\n",drawMode:4,isIndexed:!0,sourceBuffers:{a_position:this.positionBuffer,a_polygonID:this.idBuffer,indices:this.indexBuffer}}),this.filterTransform=new c.Transform(e,{id:"filter transform",vs:"#version 300 es\nin vec2 a_position;\nout vec2 filterValueIndex; //[x: 0 (outside polygon)/1 (inside), y: position index]\nvoid main()\n{\n  filterValueIndex = textureFilter_filter(a_position);\n}\n",modules:[Nn],varyings:["filterValueIndex"]})}},{key:"_updateResources",value:function(t,e,n,r){var i=function(t,e){for(var n,r,i=1/0,o=-1/0,a=1/0,u=-1/0,s=0;s<e;s++)r=t[2*s],n=t[2*s+1],i=n<i?n:i,o=n>o?n:o,a=r<a?r:a,u=r>u?r:u;return[a,i,u,o]}(t,r),o=qt()(i,4),a=o[0],u=o[1],s=o[2]-a,c=o[3]-u,l=s/c,f=this.textureSize,h=f,v=f;l>1?v=h/l:h=v*l,this.boundingBox=i,this.polygonTexture.resize({width:h,height:v,mipmaps:!1}),this.positionBuffer.setData(new Float32Array(t)),this.idBuffer.setData(new Float32Array(n)),this.indexBuffer.setData(new Uint16Array(e)),this.polyTextureTransform.update({elementCount:e.length,_targetTexture:this.polygonTexture}),this.polyTextureTransform.run({uniforms:{boundingBoxOriginSize:[a,u,s,c]}})}}]),t}();function Jn(t){for(var e=[],n=[],r=[],i=0,o=0,a=0;a<t.length;a++){var u=Yn(t[a],2),s=u.positions||u,l=s.length/2,f=new Array(l).fill(o);e.push.apply(e,Zt()(s)),r.push.apply(r,Zt()(f));for(var h=Qn(u,2),v=h.length,p=0;p<v;p++)h[p]+=i;i+=l,n.push.apply(n,Zt()(h)),o++}return Object(c.assert)(i<65536),{vertices:e,indices:n,ids:r,vertexCount:Kn(e,2)}}},,function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return o}));var i=n(10),o=("undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document,Boolean("object"!==(void 0===r?"undefined":n.n(i)()(r))||"[object process]"!==String(r)||r.browser)),a=void 0!==r&&r.version&&/v([0-9]*)/.exec(r.version);a&&parseFloat(a[1])}).call(this,n(24),n(25))}])}));