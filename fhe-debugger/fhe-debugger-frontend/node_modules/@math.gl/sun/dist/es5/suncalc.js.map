{"version":3,"sources":["../../src/suncalc.ts"],"names":["DEGREES_TO_RADIANS","Math","PI","DAY_IN_MS","JD1970","JD2000","e","M0","M1","THETA0","THETA1","getSunPosition","timestamp","latitude","longitude","longitudeWestInRadians","phi","d","toDays","c","getSunCoords","H","getSiderealTime","rightAscension","azimuth","getAzimuth","declination","altitude","getAltitude","getSunDirection","sin","cos","toJulianDay","ts","getTime","getRightAscension","eclipticLongitude","b","lambda","atan2","tan","getDeclination","asin","hourAngle","latitudeInRadians","delta","dates","getSolarMeanAnomaly","days","getEclipticLongitude","meanAnomaly","M","C","P","L"],"mappings":"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","sourcesContent":["const DEGREES_TO_RADIANS = Math.PI / 180;\n\nconst DAY_IN_MS = 1000 * 60 * 60 * 24;\nconst JD1970 = 2440588; // Julian Day year 1970\nconst JD2000 = 2451545; // Julian Day year 2000\n\n// This angle ε [epsilon] is called the obliquity of the ecliptic and its value at the beginning of 2000 was 23.4397°\nconst e = DEGREES_TO_RADIANS * 23.4397; // obliquity of the Earth\n\n// Refer https://www.aa.quae.nl/en/reken/zonpositie.html\n// \"The Mean Anomaly\" section for explanation\nconst M0 = 357.5291; // Earth mean anomaly on start day\nconst M1 = 0.98560028; // Earth angle traverses on average per day seen from the sun\n\nconst THETA0 = 280.147; // The sidereal time (in degrees) at longitude 0° at the instant defined by JD2000\nconst THETA1 = 360.9856235; // The rate of change of the sidereal time, in degrees per day.\n\n/**\n * A position in the sky defined by two angles\n * The altitude is 0° at the horizon, +90° in the zenith (straight over your head), and −90° in the nadir (straight down).\n * The azimuth is the direction along the horizon, which we measure from south to west.\n * South has azimuth 0°, west +90°, north +180°, and east +270° (or −90°, that's the same thing).\n */\nexport type CelestialPosition = {\n  azimuth: number;\n  altitude: number;\n};\n\n/**\n * Calculate sun position\n * based on https://www.aa.quae.nl/en/reken/zonpositie.html\n * inspired by https://github.com/mourner/suncalc/blob/master/suncalc.js\n */\nexport function getSunPosition(\n  timestamp: number | Date,\n  latitude: number,\n  longitude: number\n): CelestialPosition {\n  const longitudeWestInRadians = DEGREES_TO_RADIANS * -longitude;\n  const phi = DEGREES_TO_RADIANS * latitude;\n  const d = toDays(timestamp);\n\n  const c = getSunCoords(d);\n  // hour angle\n  const H = getSiderealTime(d, longitudeWestInRadians) - c.rightAscension;\n\n  return {\n    azimuth: getAzimuth(H, phi, c.declination),\n    altitude: getAltitude(H, phi, c.declination)\n  };\n}\n\nexport function getSunDirection(\n  timestamp: number | Date,\n  latitude: number,\n  longitude: number\n): number[] {\n  const {azimuth, altitude} = getSunPosition(timestamp, latitude, longitude);\n\n  // solar position to light direction\n  return [\n    Math.sin(azimuth) * Math.cos(altitude),\n    Math.cos(azimuth) * Math.cos(altitude),\n    -Math.sin(altitude)\n  ];\n}\n\nfunction toJulianDay(timestamp: number | Date): number {\n  const ts = typeof timestamp === 'number' ? timestamp : timestamp.getTime();\n  return ts / DAY_IN_MS - 0.5 + JD1970;\n}\n\nfunction toDays(timestamp: number | Date): number {\n  return toJulianDay(timestamp) - JD2000;\n}\n\nfunction getRightAscension(eclipticLongitude: number, b: number): number {\n  const lambda = eclipticLongitude;\n  return Math.atan2(Math.sin(lambda) * Math.cos(e) - Math.tan(b) * Math.sin(e), Math.cos(lambda));\n}\n\nfunction getDeclination(eclipticLongitude: number, b: number): number {\n  const lambda = eclipticLongitude;\n  return Math.asin(Math.sin(b) * Math.cos(e) + Math.cos(b) * Math.sin(e) * Math.sin(lambda));\n}\n\nfunction getAzimuth(hourAngle: number, latitudeInRadians: number, declination: number): number {\n  const H = hourAngle;\n  const phi = latitudeInRadians;\n  const delta = declination;\n  return Math.atan2(Math.sin(H), Math.cos(H) * Math.sin(phi) - Math.tan(delta) * Math.cos(phi));\n}\n\nfunction getAltitude(hourAngle: number, latitudeInRadians: number, declination: number): number {\n  const H = hourAngle;\n  const phi = latitudeInRadians;\n  const delta = declination;\n  return Math.asin(Math.sin(phi) * Math.sin(delta) + Math.cos(phi) * Math.cos(delta) * Math.cos(H));\n}\n\n// https://www.aa.quae.nl/en/reken/zonpositie.html\n// \"The Observer section\"\nfunction getSiderealTime(dates: number, longitudeWestInRadians: number): number {\n  return DEGREES_TO_RADIANS * (THETA0 + THETA1 * dates) - longitudeWestInRadians;\n}\n\nfunction getSolarMeanAnomaly(days: number): number {\n  return DEGREES_TO_RADIANS * (M0 + M1 * days);\n}\n\nfunction getEclipticLongitude(meanAnomaly: number): number {\n  const M = meanAnomaly;\n  // equation of center\n  const C =\n    DEGREES_TO_RADIANS * (1.9148 * Math.sin(M) + 0.02 * Math.sin(2 * M) + 0.0003 * Math.sin(3 * M));\n  // perihelion of the Earth\n  const P = DEGREES_TO_RADIANS * 102.9372;\n\n  return M + C + P + Math.PI;\n}\n\nfunction getSunCoords(dates: number): {\n  declination: number;\n  rightAscension: number;\n} {\n  const M = getSolarMeanAnomaly(dates);\n  const L = getEclipticLongitude(M);\n\n  return {\n    declination: getDeclination(L, 0),\n    rightAscension: getRightAscension(L, 0)\n  };\n}\n"],"file":"suncalc.js"}