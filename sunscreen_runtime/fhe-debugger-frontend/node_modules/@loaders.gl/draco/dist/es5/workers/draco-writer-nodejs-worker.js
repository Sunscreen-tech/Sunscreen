"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _workerUtils = require("@loaders.gl/worker-utils");
var _dracoWriterNodejs = require("../draco-writer-nodejs");
(function () {
  if (!_workerUtils.WorkerBody.inWorkerThread()) {
    return;
  }
  _workerUtils.WorkerBody.onmessage = function () {
    var _ref = (0, _asyncToGenerator2.default)(_regenerator.default.mark(function _callee(type, payload) {
      var input, options, result, message;
      return _regenerator.default.wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            _context.t0 = type;
            _context.next = _context.t0 === 'process' ? 3 : 16;
            break;
          case 3:
            _context.prev = 3;
            input = payload.input, options = payload.options;
            _context.next = 7;
            return _dracoWriterNodejs.DracoWriterNodeJS.encode(input, options);
          case 7:
            result = _context.sent;
            _workerUtils.WorkerBody.postMessage('done', {
              result: result
            });
            _context.next = 15;
            break;
          case 11:
            _context.prev = 11;
            _context.t1 = _context["catch"](3);
            message = _context.t1 instanceof Error ? _context.t1.message : '';
            _workerUtils.WorkerBody.postMessage('error', {
              error: message
            });
          case 15:
            return _context.abrupt("break", 16);
          case 16:
          case "end":
            return _context.stop();
        }
      }, _callee, null, [[3, 11]]);
    }));
    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();
})();
//# sourceMappingURL=draco-writer-nodejs-worker.js.map