{"version":3,"file":"transform.js","names":["transformTile","tile","extent","transformed","z2","z","tx","x","ty","y","_iterator","_createForOfIteratorHelper","features","_step","s","n","done","feature","value","geom","geometry","type","j","length","push","transformPoint","ring","k","err","e","f","Math","round"],"sources":["../../../../src/lib/geojson-tiler/transform.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n\nimport type {GeoJSONTile} from './tile';\n\n/**\n * Transforms the coordinates of each feature in the given tile from\n * mercator-projected space into (extent x extent) tile space.\n */\nexport function transformTile(tile: GeoJSONTile, extent: number): GeoJSONTile {\n  if (tile.transformed) {\n    return tile;\n  }\n\n  const z2 = 1 << tile.z;\n  const tx = tile.x;\n  const ty = tile.y;\n\n  for (const feature of tile.features) {\n    const geom = feature.geometry;\n    const type = feature.type;\n\n    feature.geometry = [];\n\n    if (type === 1) {\n      for (let j = 0; j < geom.length; j += 2) {\n        feature.geometry.push(transformPoint(geom[j], geom[j + 1], extent, z2, tx, ty));\n      }\n    } else {\n      for (let j = 0; j < geom.length; j++) {\n        const ring: number[][] = [];\n        for (let k = 0; k < geom[j].length; k += 2) {\n          ring.push(transformPoint(geom[j][k], geom[j][k + 1], extent, z2, tx, ty));\n        }\n        feature.geometry.push(ring);\n      }\n    }\n  }\n\n  tile.transformed = true;\n\n  return tile;\n}\n\n// eslint-disable-next-line max-params\nfunction transformPoint(\n  x: number,\n  y: number,\n  extent: number,\n  z2: number,\n  tx: number,\n  ty: number\n): number[] {\n  return [Math.round(extent * (x * z2 - tx)), Math.round(extent * (y * z2 - ty))];\n}\n"],"mappings":";;;;;;;;;AASO,SAASA,aAAaA,CAACC,IAAiB,EAAEC,MAAc,EAAe;EAC5E,IAAID,IAAI,CAACE,WAAW,EAAE;IACpB,OAAOF,IAAI;EACb;EAEA,IAAMG,EAAE,GAAG,CAAC,IAAIH,IAAI,CAACI,CAAC;EACtB,IAAMC,EAAE,GAAGL,IAAI,CAACM,CAAC;EACjB,IAAMC,EAAE,GAAGP,IAAI,CAACQ,CAAC;EAAC,IAAAC,SAAA,GAAAC,0BAAA,CAEIV,IAAI,CAACW,QAAQ;IAAAC,KAAA;EAAA;IAAnC,KAAAH,SAAA,CAAAI,CAAA,MAAAD,KAAA,GAAAH,SAAA,CAAAK,CAAA,IAAAC,IAAA,GAAqC;MAAA,IAA1BC,OAAO,GAAAJ,KAAA,CAAAK,KAAA;MAChB,IAAMC,IAAI,GAAGF,OAAO,CAACG,QAAQ;MAC7B,IAAMC,IAAI,GAAGJ,OAAO,CAACI,IAAI;MAEzBJ,OAAO,CAACG,QAAQ,GAAG,EAAE;MAErB,IAAIC,IAAI,KAAK,CAAC,EAAE;QACd,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,IAAI,CAACI,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;UACvCL,OAAO,CAACG,QAAQ,CAACI,IAAI,CAACC,cAAc,CAACN,IAAI,CAACG,CAAC,CAAC,EAAEH,IAAI,CAACG,CAAC,GAAG,CAAC,CAAC,EAAEpB,MAAM,EAAEE,EAAE,EAAEE,EAAE,EAAEE,EAAE,CAAC,CAAC;QACjF;MACF,CAAC,MAAM;QACL,KAAK,IAAIc,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGH,IAAI,CAACI,MAAM,EAAED,EAAC,EAAE,EAAE;UACpC,IAAMI,IAAgB,GAAG,EAAE;UAC3B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,IAAI,CAACG,EAAC,CAAC,CAACC,MAAM,EAAEI,CAAC,IAAI,CAAC,EAAE;YAC1CD,IAAI,CAACF,IAAI,CAACC,cAAc,CAACN,IAAI,CAACG,EAAC,CAAC,CAACK,CAAC,CAAC,EAAER,IAAI,CAACG,EAAC,CAAC,CAACK,CAAC,GAAG,CAAC,CAAC,EAAEzB,MAAM,EAAEE,EAAE,EAAEE,EAAE,EAAEE,EAAE,CAAC,CAAC;UAC3E;UACAS,OAAO,CAACG,QAAQ,CAACI,IAAI,CAACE,IAAI,CAAC;QAC7B;MACF;IACF;EAAC,SAAAE,GAAA;IAAAlB,SAAA,CAAAmB,CAAA,CAAAD,GAAA;EAAA;IAAAlB,SAAA,CAAAoB,CAAA;EAAA;EAED7B,IAAI,CAACE,WAAW,GAAG,IAAI;EAEvB,OAAOF,IAAI;AACb;AAGA,SAASwB,cAAcA,CACrBlB,CAAS,EACTE,CAAS,EACTP,MAAc,EACdE,EAAU,EACVE,EAAU,EACVE,EAAU,EACA;EACV,OAAO,CAACuB,IAAI,CAACC,KAAK,CAAC9B,MAAM,IAAIK,CAAC,GAAGH,EAAE,GAAGE,EAAE,CAAC,CAAC,EAAEyB,IAAI,CAACC,KAAK,CAAC9B,MAAM,IAAIO,CAAC,GAAGL,EAAE,GAAGI,EAAE,CAAC,CAAC,CAAC;AACjF"}